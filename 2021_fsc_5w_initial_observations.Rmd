---
title: "Initial observations on the Myanmar Food Security Cluster 5Ws"
author: "Myanmar Food Security Cluster"
date: "04/02/2022"
output:
  html_document:
    code_download: yes
    theme: readable
    toc: yes
    toc_depth: 4
    toc_float: yes
    number_sections: no
    collapsed: no
always_allow_html: yes
---

```{css, echo=FALSE}

#TOC::before {
  content: "";
  display: block;
  height: 70px;
  margin: 2em 20px 40px 20px;
  background-image: url("Myanmar_cluster_blue.png");
  background-size: contain;
  background-position: center center;
  background-repeat: no-repeat;
}
```

```{=html}
<style>
    body .main-container {
        max-width: 1280px;
    }
</style>
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width=9, message = FALSE, warning=FALSE)
library(tidyverse)
library(readxl)
library(lubridate)
library(stringi)
library(pander)
library(janitor)
library(fuzzyjoin)
library(scales)
library(magrittr)
library(sf)
library(s2)
library(bookdown)
library(data.table)
library(ggsflabel)
library(patchwork)
library(plotly)
library(kableExtra)
library(DT)
library(viridis)
library(tinytex)


theme_set(theme_light())

# disabling scientific notation
options(scipen = 100)

# pander tables all in one row
panderOptions('table.split.table', Inf)

# pander thousands separator
panderOptions("big.mark", ",")

# replace 
opts <- options(knitr.kable.NA = "")

`%out%` <- Negate(`%in%`)

# function for transposing df
transpose_df <- function(df) {
  t_df <- data.table::transpose(df)
  colnames(t_df) <- rownames(df)
  rownames(t_df) <- colnames(df)
  t_df <- t_df %>%
    tibble::rownames_to_column(.data = .) %>%
    tibble::as_tibble(.)
  return(t_df)
}

# function beneficiary summaries
sum_ben <- function(df, column_var){
  
  column_var <- enquo(column_var)
  
  df %>%
    group_by(!!column_var) %>% # must add bang-bang
    summarise(beneficiaries = sum(beneficiaries)) %>% 
    arrange(desc(beneficiaries))
    
}

# function beneficiary summaries, 2 grouped variables
sum_ben2 <- function(df, column_var1, column_var2){
  
  column_var1 <- enquo(column_var1)
  column_var2 <- enquo(column_var2)
  
  df %>%
    group_by(!!column_var1, !!column_var2) %>% # must add bang-bang
    summarise(beneficiaries = sum(beneficiaries)) %>% 
    arrange(desc(beneficiaries))
    
}

revlog_trans <- function(base = exp(1)){
    ## Define the desired transformation.
    trans <- function(x){
                 -log(x, base)
                }
    ## Define the reverse of the desired transformation
    inv <- function(x){
                 base^(-x)
                }
    ## Creates the transformation
    trans_new(paste("revlog-", base, sep = ""),
              trans, ## The transformation function (can be defined using anonymous functions)
              inv,  ## The reverse of the transformation
              log_breaks(base = base), ## default way to define the scale breaks
              domain = c(1e-100, Inf) ## The domain over which the transformation is valued
             )
    }

# reading in townships from geoadmins 
townships <- read_excel("FSC 5W 2021 - GEOADMINS_final 19.xlsx",
           sheet = "GEOADMINS") %>% 
  clean_names() %>% 
  select(admin1pcode_4:admin3pcode) %>% 
  rename(admin1_pcode = admin1pcode_4,
         admin3_pcode = admin3pcode,
         state_name   = state_5,
         township_name  = county) %>% 
  remove_empty()

# locations dataset 
locations <- bind_rows(
  
  read_excel("FSC 5W 2021 - GEOADMINS_final 19.xlsx", # payams 
             sheet = "GEOADMINS") %>% 
    clean_names() %>% 
    select(state_name:payam_code) %>% 
    rename(admin1_pcode = state_code_12,
           township_name = county_name, 
           admin3_pcode = county_code,
           location = payam_name) %>%
    remove_empty() %>% 
    mutate(location_type = paste0("payam")),
  
  read_excel("FSC 5W 2021 - GEOADMINS_final 19.xlsx", # camps
             sheet = "GEOADMINS") %>% 
    clean_names() %>% 
    select(county_name1:p_code_camp) %>% 
    rename(township_name = county_name1,
           admin3_pcode = state_code_23,
           location = camps, 
           camp_pcode = p_code_camp) %>% 
    remove_empty() %>% 
    mutate(location_type = paste0("camp")) %>% 
    left_join(townships %>% select(state_name, admin1_pcode, admin3_pcode), 
              by = c("admin3_pcode")) %>% 
    relocate(admin1_pcode) %>% 
    relocate(state_name),
  
  read_excel("FSC 5W 2021 - GEOADMINS_final 19.xlsx", # industrial zones
             sheet = "GEOADMINS") %>% 
    clean_names() %>%
    select(state_28:industrial_zones) %>% 
    rename(state_name = state_28, 
           admin1_pcode = admin1pcode_29,
           location = industrial_zones) %>%
    remove_empty() %>% 
    regex_left_join(townships %>% select(township_name, admin3_pcode),
                    by = c("location" = "township_name")) %>% 
    # replacing the NAs with 0s so the filter doesn't drop them 
    replace_na(list(township_name = 0, admin3_pcode = 0, admin1_pcode = 0)) %>%
    filter(admin3_pcode != "MMR013040") %>% # removing all the matches between Hlaingtharya and Hlaing
    filter(admin3_pcode != "MMR011006") %>% # removing all the matches between Yenangyaung and Ye
    mutate(location_type = paste0("industrial_zone"))
  
)%>%
  mutate(location_code = case_when(location_type == "camp" ~ camp_pcode,
                                   location_type == "payam" ~ payam_code,
                                   location_type == "industrial_zone" ~ NA_character_)) %>%
  mutate(locations_fuzzy = str_replace_all(location, "[[:punct:]]", ""),
         locations_fuzzy = tolower(locations_fuzzy),
         location = tolower(location))

# reading in pin and targets
pin <- read_excel("PIN calculation Food Security Cluster_Township Breakdown.xlsx",
           sheet = "Food Sec PiN with IDPs", 
           skip = 2) %>% 
  clean_names() %>% 
  select(-c(x17, x18, x19)) %>% 
  slice(1:346) %>% 
  fill(region) %>% 
  rename(state = region,
         idps = id_ps, 
         pop_minus_idps = population_minus_id_ps, 
         pin_2022 = vulnerable_food_insecure_people_id_ps) %>%  
  filter(township != "Total") %>%  
  mutate_at(vars(pop_minus_idps:moderately_severely), ~ as.numeric(.)) %>% 
  mutate(state = recode(state, "Shan East" = "Shan (East)",
                        "Shan North" = "Shan (North)",
                        "Ayeyawady" = "Ayeyarwady",
                        "Shan ((south))" = "Shan (South)", 
                        "Naypyitaw" = "Nay Pyi Taw")) %>% 
  left_join(townships, by = c("township" = "township_name", "state" = "state_name")) %>% 
  relocate(admin3_pcode) %>% relocate(admin1_pcode) %>% 
  mutate(pc_vul = pin_2022 / total_pop,
         pin_2022 = round(pin_2022, digits = 0)) %>% 
  left_join(read_excel("FSC PIN and Target _combine HRP and IERP 2021.xlsx") %>%
              clean_names() %>%
              select(admin3_pcode = tsp_pcode, pin_2021 = pin, target_2021 = target), by = "admin3_pcode") %>% 
  left_join(read_excel("fs_targets_2021.xlsx") %>%
              clean_names() %>% 
              select(township = x1,
                     hrp_target_idps_2021 = internally_displaced_persons_12,
                     hrp_target_returnees_2021 = idp_returnees_resettled_locally_integrated_13,
                     hrp_target_stateless_rakhine_2021 = non_displaced_stateless_people_in_rakhine_14,
                     hrp_target_other_vulnerable_2021 = other_vulnerable_crisis_affected_people_15,
                     hrp_target_total = total_16) %>%
              left_join(townships %>%  select(township_name, admin3_pcode), by = c("township" = "township_name")) %>% 
              select(-township),
            by = "admin3_pcode") %>%
  replace(is.na(.), 0) %>% 
  left_join(read_excel("FSC PIN and Target _combine HRP and IERP 2021.xlsx") %>%
              clean_names() %>%
              select(admin3_pcode = tsp_pcode, hrp_version), by = "admin3_pcode") %>%  
  mutate(hrp_version = recode(hrp_version,
                              "HRP 2021" = "hrp",
                              "HRP Addendum" = "ierp")) %>% 
  mutate(admin3_pcode = ifelse(admin3_pcode == "MMR007014" & state == "Yangon", "MMR013006", admin3_pcode),
         admin3_pcode = ifelse(state == "Magway" & township == "Minhla", "MMR009013", admin3_pcode)) %>%  
  rename(target_2022 = target) %>% 
  # Yangon somehow has all their target and pin reversed? 
  mutate(pin_new = ifelse(state == "Yangon", target_2022, pin_2022),  
               target_new = ifelse(state == "Yangon", pin_2022, target_2022))

# this exists for the HRP / non-HRP column 
hrp2021_adm3_list <- pin %>% filter(hrp_version == "hrp") %>% pull(admin3_pcode)

# reading in 5ws
fsc <- read_excel(
  "FSC 5W 2021 - GEOADMINS_final 19_Jan to Dec 2021 IM Combined_Draft_28012022.xlsx",
                  sheet = "FSC 5W Activites",
                  skip = 5) %>% 
  janitor::clean_names() %>% 
  select(month_of_implementation:hrp_version) %>% 
  rename_all(~str_replace_all(., "^number_of_", "")) %>%
  rename_all(~str_replace_all(., "^number_", "")) %>% 
  rename(admin5_pcode = admin3_pcode, 
         admin3_pcode = admin2_pcode,
         beneficiaries = reached_beneficiaries,
         households = reached_households,
         beneficiary_type = beneficiaries_type) %>% 
  mutate(industrial_zones = replace(industrial_zones, industrial_zones == "No", NA),
         frequency = replace(frequency, frequency == "N/A", NA)) %>% 
  mutate(location = case_when(camp != "NA" ~ camp,
                              industrial_zones != "NA" ~ industrial_zones,
                              village_ward_town != "NA" ~ village_ward_town)) %>% 
  mutate(location_type = case_when(camp != "NA" ~ "camp",
                              industrial_zones != "NA" ~ "industrial_zone",
                              village_ward_town != "NA" ~ "village_ward_town"),
         locations_fuzzy = str_replace_all(location, "[[:punct:]]", " "),
         locations_fuzzy = tolower(locations_fuzzy),
         location = tolower(location)) %>%
  mutate(total_value_mmk = value_per_household * households,
         date            = my(month_of_implementation),
         u_ben           = ifelse(unique_beneficiaries == "Yes", beneficiaries, 0)) %>% 
  mutate(state = as.character(fct_recode(state, 
                            "Kachin" = "kachin")),
         frequency = recode(frequency, "monthly" = "Monthly"),
         township = recode(township, "kyaukme" = "Kyaukme")) %>% 
  mutate(new_value_hhd = total_value_usd / households,
         new_value_person = total_value_usd / beneficiaries,
         usd_hhd_bin = 
           case_when(new_value_hhd < 10 ~ "<$10",
                     new_value_hhd >= 10 & new_value_hhd < 20 ~ ">=$10_<$20",
                     new_value_hhd >= 20 & new_value_hhd < 30 ~ ">=$20_<$30",
                     new_value_hhd >= 30 & new_value_hhd < 40 ~ ">=$30_<$40",
                     new_value_hhd >= 40 & new_value_hhd < 50 ~ ">=$40_<$50",
                     new_value_hhd >= 50 & new_value_hhd < 60 ~ ">=$50_<$60",
                     new_value_hhd >= 60 & new_value_hhd < 70 ~ ">=$60_<$70",
                     new_value_hhd >= 70 & new_value_hhd < 80 ~ ">=$70_<$80",
                     new_value_hhd >= 80 & new_value_hhd < 90 ~ ">=$80_<$90",
                     new_value_hhd >= 90 & new_value_hhd < 100 ~ ">=$90_<$100",
                     new_value_hhd >= 100 ~ ">=$100",
                     TRUE ~ NA_character_),
         usd_hhd_bin = fct_relevel(usd_hhd_bin, c("<$10", ">=$10_<$20", ">=$20_<$30", ">=$30_<$40", ">=$40_<$50",">=$50_<$60", 
                                                  ">=$60_<$70", ">=$70_<$80", ">=$80_<$90",">=$90_<$100",">=$100"))) %>% 
  mutate(hrp_indicator =
          recode(hrp_indicator,
          "Number of people who received food and/or cash assistance" = 
            "1.Number of people who received food and/or cash assistance",
          "Number of people who received agriculture and other livelihood support, contributing to household food security" =
            "2.Number of people who received agriculture and other livelihood support")) %>% 
  mutate(beneficiary_type = str_trim(beneficiary_type)) %>% 
  mutate(beneficiary_type = as.character(fct_recode(beneficiary_type, 
               "Rakhine stateless" = "Non-displaced stateless people in Rakhine"))) %>% 
  mutate(activity = recode(activity, 
                          "Provide monthly food baskets through in-kind assistance to acutely food insecure population in rural areas" = 
                            "Provide monthly food baskets",
                          "Provide technical training (agriculture, livestock breeding, livelihood)" = "Provide technical training",
                          "Provide support for Income Generating Activities" = "Provide support for income generation",
                          "Provide monthly cash-based transfers to acutely food insecure population in rural areas" =
                            "Provide monthly cash-based transfers",
                          "Cash for Work / Food for Assets activities" = "Cash for Work / Food for Assets",
                          "Provide fishery kits (in-kind / CBT)" = "Provide fishery kits",
                          "Provide crops & vegetables kits (in-kind / CBT)" = "Provide crops & vegetables kits",
                          "Provide livestock kits (in-kind / CBT)" = "Provide livestock kits")) %>% 
  mutate(implementing_partners = recode(implementing_partners, 
                                        "Save the children" = "Save the Children")) %>% 
  mutate(implementing_partner_type = 
           ifelse(implementing_partners %in% c("Kaw Lah Foundation", "Hakha Baptist Association (HBA)", "Arkan Research and Watch",
                                               "Hlaing Development Network", "Mangrove Service Network (MSN)", "Kyal Sin May",
                                               "Swan Saung Shin", "Sein Lei Ayeyar"), "NNGO", implementing_partner_type),
         implementing_partner_type = 
           ifelse(implementing_partners %in% c("Single Touch Point Company Limited (STP)", "Neo Prospect Company Limited"), 
                  "other", implementing_partner_type),
         implementing_partner_type = ifelse(implementing_partners == "Helen Keller International", "INGO", implementing_partner_type)) %>%  
  mutate(hrp_ierp = case_when(admin3_pcode %in% hrp2021_adm3_list ~ "hrp",
                             date > "2021-05-01" ~ "ierp",
                             TRUE ~ "non_hrp")) %>% 
  mutate(covid_19_response = recode(covid_19_response, 
                                          "No" = "no", "Yes" = "yes"),
               covid_19_response = replace_na(covid_19_response, "no"))

# ben dataset -- tidy format 5Ws for beneficiaries 
ben <- fsc %>% 
  filter(unique_beneficiaries == "Yes") %>%  
  select(date,
         implementing_partners, implementing_partner_type,
         state, township, village_ward_town, location, location_type, admin1_pcode, admin3_pcode,
         activity, activity_status, hrp_indicator, beneficiary_type, 
         child_male, child_female, adult_male, adult_female, elderly_male, elderly_female) %>% 
  pivot_longer(cols = child_male:elderly_female, 
               names_to = "disaggregation", values_to = "beneficiaries", values_drop_na = TRUE)

# shapefiles
pcode3_shape <- st_read("./mmr_polbnda_adm3_mimu_250k/mmr_polbnda_adm3_mimu_250k.shp", quiet = TRUE) %>% 
 rename(state = ST, 
        admin1_pcode = ST_PCODE,
        township = TS,
        admin3_pcode = TS_PCODE) %>% 
 mutate(admin3_pcode = ifelse(str_detect(township, "Hlaingtharya"), "MMR013008", admin3_pcode))

# pcode3_shape <- st_read("./admin3 boundary old version/admin3 boundary old version.shp", quiet = TRUE) %>% 
#   rename(state = ST, 
#           admin1_pcode = ST_PCODE,
#           township = TS,
#           admin3_pcode = TS_PCODE) 

# for relevelling -- this is in order of beneficiaries
sr_ord <- c("Yangon", "Rakhine", "Mandalay", "Ayeyarwady", "Magway", "Kachin", "Shan (North)", "Kayin",
 "Mon", "Sagaing", "Kayah", "Chin", "Shan (South)", "Bago (East)", "Tanintharyi", "Shan (East)")

# for printing the targets of the pin 
target_ben_2021 <- pin %>%  
  select(admin3_pcode, state, township, target_2021) %>% 
  filter(target_2021 > 0) %>% 
  left_join(ben %>% 
              group_by(admin3_pcode) %>% 
              summarise(beneficiaries = sum(beneficiaries)), by = "admin3_pcode") %>% 
  mutate(pc_reached = beneficiaries / target_2021 * 100) %>%  
  replace(is.na(.), 0) 

# shows colours and hecx codes in palette
# show_col(hue_pal()(6))
```

```{r table-acronyms}
tribble(
  ~acronym, ~name, 
  "CBT", "Cash-based Transfers",
  "CCCM", "Camp Management and Camp Coordination",
  "CSO", "Civil Society Organisation", 
  "CWG", "Cash Working Group",
  "FAO", "Food and Agriculture Organisation",
  "FSC", "Food Security Cluster",
  "HNO", "Humanitarian Needs Overview",
  "HRP", "Humanitarian Response Plan",
  "IDP", "Internally Displaced Person",
  "IERP", "Interim Emergency Response Plan",
  "MEB", "Minimum Expenditure Basket",
  "NFI", "Non-food Items",
  "NNGO", "National Non-governmental Organisation", 
  "OCHA", "UN Office for the Coordination of Humanitarian Affairs", 
  "PIN", "People in Need",
  "WFP", "World Food Programme"
) %>% 
  kable(caption = "**Acronyms**", col.names = NULL) %>% 
  kable_classic_2(position = "left", full_width = FALSE)
```
<br>

## Introduction

This report is an overview of the initial observations and analysis performed on the Food Security Cluster 5Ws data for 2021; the issues identified and analysis have been broken into large groups corresponding with the first 4 chapters of the FSC 2021 5Ws matrix -- geographical coverage, activities and modalities, partners and beneficiaries. This report ends with a brief section on next steps and an interactive reference table and interactive reference maps.

The FSC has endeavoured to provide actionable information and believe that releasing this report is a necessary part of jump-starting the process of resolving the more pressing concerns identified. Further analysis is merited in several areas; and this will be undertaken once consultations with partners have been completed. Unless otherwise specified, beneficiary figures in this report are unique beneficiaries, as opposed to beneficiary frequencies.


<br><br>

### a. Summary of key findings

* The 2021 response was **skewed towards very few areas** -- Yangon and Rakhine form 78% of the beneficiaries reached, with 24% of all beneficiaries originate from Hlaingtharya township alone. The top 10 townships account for 76% of all beneficiaries reached. 

* Six of the eight Food Security activities (monthly food baskets, support for income generation, cash for work/food for assets, livestock kits, crop and vegetable kits and fishery kits) experienced **large ramp ups** in beneficiaries reached after the addition of the 2021 HRP addendum; but the caseloads for the provision of cash-based transfers and technical training were largely established prior to 2021 and only saw incremental increases in beneficiaries reached throughout the year. 

* **61%** of beneficiary frequencies received support through the in-kind delivery modality; **25%** of beneficiary frequencies were reached by cash transfers. Of beneficiaries who received cash transfers, 84% of them were reached through direct cash payments. 

* The most common transfer values -- in terms of beneficiaries reached -- are **between USD 60 and 70** per month per household, it should also be noted that a not insignificant number of households (about 8%) were reached by cash transfer interventions valued at USD 100 per household or more. The highest average cash transfers were from the provision of livestock kits and the lowest averages from Cash for work/food for assets activities.

* Around 60% of beneficiary households have received 50% or more of the **Minimum Expenditure Basket (MEB)** for food for the months they were covered. However, about 10% of all beneficiary households for monthly cash-based transfers received under USD 20 per month (less than 10% of the MEB) and 23% of households received between USD 20 and USD 40 (22% of the MEB). 

* There are a total of 71 FSC partners, **62 of whom reported achievements through the 5Ws**. 27 partners classified themselves as reporting organisations, though 23 of these were also implementing partners. 

* **Only 13 implementing partners have a presence in more than 5 townships**, and only 8 have a presence in more than 10. 78% of partners are present in less than 5 townships. 34 implementing partners have reached less than 10,000 beneficiaries throughout 2021 and the median number of beneficiaries reached in this period by implementing partners is 6,118.

* **Age and sex-disaggregated beneficiary figures** are one of the most key pieces of missing data in the 5W dataset. Values have been largely backfilled from census data and do not provide an accurate representation of the population reached. 

* **82.68% of beneficiaries are from the host/local community**, 9.02% are stateless persons from Rakhine and 8.24% are IDPs. Returnees are the rarest type of beneficiary reached, forming only 0.07% of all beneficiaries reached.

* 49% of beneficiaries of monthly activities experienced **gaps or delays in monthly programming**, with the most common delay being 3 months. Gaps in monthly programming were experienced in 39 townships, with the majority originating from Kachin, Ayeyarwady and Rakhine.

* Food Security Cluster partners are **not well-positioned to cover the 2022 population in need**. Partners are largely concentrated in Kachin, Rakhine and Yangon, with only one partner present in Shan (East) and two in Tanintharyi. Overall, 58% of townships, containing 46% of the 2022 PIN, do not have any partners present.

<br><br>

### b. Achievements related to the HRP and IERP

```{r df-hrp-version-tab}
hrp_version_tab <- fsc %>% 
  group_by(hrp_ierp) %>% 
  summarise(beneficiaries = sum(u_ben, na.rm = TRUE),
            townships = n_distinct(admin3_pcode),
            implementing_partners = n_distinct(implementing_partners)) %>% 
  rename(hrp_version = hrp_ierp) %>%
  left_join(pin %>% 
              filter(!is.na(hrp_version)) %>% 
              group_by(hrp_version) %>% 
              summarise(target_2021 = round(sum(target_2021, na.rm = TRUE))), by = "hrp_version") %>% 
  mutate(pc_of_ben = round(beneficiaries / sum(beneficiaries) * 100, digits = 2)) %>% 
  relocate(beneficiaries, .after = implementing_partners) %>% 
  relocate(pc_of_ben, .after = beneficiaries)
```

Though this document is not intended to report on or focus on solely HRP-related activities as it is important to analyse the entirety of all Food Security activities reported in 2021. This preliminary section contains a brief summary of Humanitarian Response Plan (HRP) and HRP addendum-related achievements. In 2021, `r filter(hrp_version_tab, hrp_version == "hrp") %>% pull(pc_of_ben)`% of reached beneficiaries were related to the original HRP and `r filter(hrp_version_tab, hrp_version == "ierp") %>% pull(pc_of_ben)`% were related to the HRP addendum (IERP):

```{r hrp-version-table}
# too much manual calculation in this table -- I know you don't have time now, but you need to fix this at some point
hrp_version_tab %>%  
  rbind(fsc %>%  
    summarise(beneficiaries = sum(u_ben, na.rm = TRUE),
              townships = n_distinct(admin3_pcode),
              implementing_partners = n_distinct(implementing_partners)) %>% 
      mutate(hrp_version = ifelse(is.numeric(beneficiaries), "total", ""),
             pc_of_ben = ifelse(is.numeric(beneficiaries), 100.00, 0), 
             target_2021 = 601235 + 2167114)) %>% 
  mutate(pc_of_target = ifelse(hrp_version == "total", round((beneficiaries - 475444) / target_2021 * 100, digits = 2),
                               round(beneficiaries / target_2021 * 100, digits = 2))) %>% 
  kable(caption = "Beneficiaries, townships and implementing partners by HRP, HRP addendum and non-HRP activities",
        format.args = list(big.mark = ",")) %>% 
  kable_classic_2("striped") %>%  
  footnote("'pc_of_target' only takes into account the 2,785,524 HRP and IERP beneficiaries",
           general_title = "")
# pander(caption = "Beneficiaries, townships and implementing partners by HRP, HRP addendum and non-HRP activities")

```


<br>


```{r df-hrp-act}
hrp_act <- fsc %>%  
  filter(unique_beneficiaries == "Yes" & hrp_ierp != "non_hrp") %>% 
  sum_ben(activity) %>% 
  mutate(pc_of_ben = round(beneficiaries / sum(beneficiaries) * 100, digits = 2))
```


The provision of monthly food baskets was the single largest activity, forming `r filter(hrp_act, activity == "Provide monthly food baskets") %>% pull(pc_of_ben)`% of all reached beneficiaries. This was followed by the provision of monthly cash-based transfers and the provision of crop and vegetable kits. 

```{r table-hrp-ierp-hrp-indicator}

# I don't think this is necessary 
hrp_act_ord <- fsc %>% 
 filter(hrp_ierp != "non_hrp" & unique_beneficiaries == "Yes") %>% 
 sum_ben(activity)


fsc %>% 
  filter(unique_beneficiaries == "Yes" & hrp_ierp != "non_hrp") %>% 
  sum_ben2(hrp_indicator, hrp_ierp) %>% 
  ungroup() %>% 
  pivot_wider(names_from = hrp_ierp, values_from = beneficiaries) %>% 
  mutate(total_HRP_IERP = hrp + ierp,
         pc_of_total = round(total_HRP_IERP / sum(total_HRP_IERP) * 100, digits = 2)) %>% 
  select(`HRP_indicator` = hrp_indicator, HRP = hrp, IERP = ierp, total_HRP_IERP, pc_of_total) %>% 
  kable(caption = "Beneficiaries reached, by HRP indicator", format.args = list(big.mark = ",")) %>% 
  # column_spec(6, color = spec_color(hrp_act_ord$beneficiaries[1:8], end = 0.8, direction = -1, option = "G")) %>% 
  kable_classic_2("striped") %>%  
  footnote("non-HRP beneficiaries have been excluded",
           general_title = "")


# pander(caption = "Beneficiaries reached by activity, by HRP version")
```

```{r table-hrp-ierp-hrp-activity}
fsc %>%  
  filter(unique_beneficiaries == "Yes" & hrp_ierp != "non_hrp") %>% 
  group_by(hrp_ierp, activity) %>% 
  summarise(beneficiaries = sum(beneficiaries)) %>% 
  rename(HRP_activity = activity) %>% 
  mutate(hrp_ierp = recode(hrp_ierp, "hrp" = "HRP", "ierp" = "IERP")) %>% 
  pivot_wider(names_from = hrp_ierp, values_from = beneficiaries) %>% 
  mutate(total_HRP_IERP = HRP + IERP,
         pc_of_total = round(total_HRP_IERP / sum(total_HRP_IERP) * 100, digits = 2)) %>% 
  arrange(desc(pc_of_total)) %>% 
  kable(caption = "Beneficiaries reached, by activity", format.args = list(big.mark = ",")) %>% 
  # column_spec(6, color = spec_color(hrp_act_ord$beneficiaries[1:8], end = 0.8, direction = -1, option = "G")) %>% 
  kable_classic_2("striped") %>%  
  footnote("non-HRP beneficiaries have been excluded",
           general_title = "") 
```

<br>

As a note, less than 7% of all beneficiaries reached were associated with COVID-19 response activities, perhaps indicating that COVID-related activities have been largely mainstreamed. Indeed, in 2021, there no specific call for a COVID-19 response. There were also relatively few 2020 COVID-19 activities from 2020 carried over into 2021. 

```{r}
fsc %>% filter(unique_beneficiaries == "Yes") %>% 
  sum_ben2(hrp_ierp, covid_19_response) %>% 
  mutate(hrp_ierp = recode(hrp_ierp, "hrp" = "HRP", "ierp" = "IERP", "non_hrp" = "non_HRP"), 
         covid_19_response = recode(covid_19_response, "no" = "No", "yes" = "Yes")) %>% 
  pivot_wider(names_from = hrp_ierp, values_from = beneficiaries) %>% 
  ungroup() %>% 
  mutate(total_ben = IERP + HRP + non_HRP, 
         pc_of_total = round(total_ben / sum(total_ben) * 100, digits = 2)) %>% 
  arrange(desc(covid_19_response)) %>% 
  kable(caption = "COVID-19 response by HRP version", format.args = list(big.mark = ",")) %>% 
  kable_classic_2() %>% 
  footnote("All beneficiaries have been included in 'total_ben'",
           general_title = "")
```


<br><br><br>

## 1. Geographical coverage

### 1.1 Comparing beneficiaries reached and 2021 PIN by state and region

A total of `r sum(ben$beneficiaries) %>% format(big.mark = ",")` unique beneficiaries have been reached across the country, of which, `r filter(hrp_version_tab, hrp_version %in% c("hrp", "ierp")) %>% {sum(.$beneficiaries)} %>% format(big.mark = ",")` pertained to HRP and IERP activities and townships and `r filter(hrp_version_tab, hrp_version == "non_hrp") %>% {sum(.$beneficiaries)} %>% format(big.mark = ",")` were non-HRP. Overall, `r round((filter(fsc, hrp_ierp %in% c("hrp", "ierp")) %>% {sum(.$u_ben, na.rm = TRUE)}) / (sum(pin$target_2021)) * 100, digits = 2)`% of the targeted `r sum(pin$target_2021) %>% format(big.mark = ",")` persons in the HRP/IERP were reached. 

<br>

```{r barplot-state-beneficiaries-pin}
# change the colours -- I really don't like these colours 

pin %>% 
  left_join(ben %>% 
              group_by(admin3_pcode) %>% 
              summarise(beneficiaries = sum(beneficiaries))) %>% 
  mutate(beneficiaries = ifelse(is.na(beneficiaries), 0, beneficiaries)) %>% 
  group_by(state) %>% 
  summarise(beneficiaries = sum(beneficiaries), 
            target_2021 = sum(target_2021), 
            pin_2021 = sum(pin_2021)) %>% 
  filter(pin_2021 > 0 | beneficiaries > 0) %>% 
  pivot_longer(-state, names_to = "type", values_to = "value") %>% 
  ggplot(aes(x = fct_relevel(state, sr_ord), y = value, fill = fct_relevel(type, c("beneficiaries", "target_2021", "pin_2021")))) +
  geom_col(position = "dodge") +
  scale_fill_viridis_d(option = "C") +
  theme(axis.text.x = element_text(vjust = 0.4, angle = 70)) +
  theme(legend.title = element_blank()) +
  labs(x = "",
       y = "", 
       title = "Food security beneficiaries and people in need (2021)",
       subtitle = "Some states/regions did not have specific HRP/IERP targets; all beneficiaries included") +
   scale_y_continuous(breaks = seq(0, 2000000, by = 200000), labels = comma)
```

<br><br>

### 1.2 Table of beneficiaries and PIN by state and region

```{r table-beneficiaries-pin-state}

state_ben_ord <- fsc %>% 
  filter(unique_beneficiaries == "Yes") %>% 
  group_by(state) %>% 
  summarise(total_ben = sum(beneficiaries)) %>% 
  mutate(`%_of_total_ben` = round(total_ben / sum(total_ben) * 100, digits = 2))%>% 
  arrange(desc(total_ben))

fsc %>% 
  filter(unique_beneficiaries == "Yes") %>% 
  group_by(state) %>% 
  summarise(HRP_ben = sum(beneficiaries[hrp_ierp == "hrp"]),
            IERP_ben = sum(beneficiaries[hrp_ierp == "ierp"]),
            non_HRP_ben = sum(beneficiaries[hrp_ierp == "non_hrp"]), 
            total_ben = sum(beneficiaries)) %>% 
  mutate(`%_of_total_ben` = round(total_ben / sum(total_ben) * 100, digits = 2))%>% 
  arrange(desc(total_ben)) %>% 
  kbl(caption = "Beneficiaries reached (desc.) by state/region", format.args = list(big.mark = ",")) %>% 
  kable_classic_2(lightable_options = c("striped")) %>% 
  column_spec(5, color = "white", background = spec_color(state_ben_ord$`%_of_total_ben`[1:16], end = 0.8, direction = -1)) %>% 
  footnote(general = "All beneficiaries have been included in this table, regardless of their inclusion in the HRP/IERP",
           general_title = "")
# pander(caption = "Beneficiaries reached (desc.) by state/region")
 

```

<br>
The response is fairly skewed at the state/region level. Yangon and Rakhine form `r round(filter(fsc, state %in% c("Yangon", "Rakhine") & unique_beneficiaries == "Yes") %>% {sum(.$beneficiaries)} / filter(fsc, unique_beneficiaries == "Yes") %>% {sum(.$beneficiaries)} * 100)`% of the beneficiaries reached. Beneficiaries from Rakhine were mostly associated with the HRP, whilst beneficiaries from Yangon were mostly associated with the IERP. 

Rakhine remains a strategic priority for donors, year after year, as needs are still high and there is a particular interest in the Rohingya and other stateless persons. In addition, the number of persons living in camps remains high (140,525 persons according to the Shelter/NFI/CCCM Cluster, as of 16 February 2022). 

When the IERP was established, under the leadership of OCHA, it was decided that a peri-urban reponse (principally in Yangon and Mandalay) would be at the core of this HRP addedndum. As a result, townships in Yangon massively "absorbed" this humanitarian assistance.

<br><br>

### 1.3 Township-level distribution of beneficiaries


Just as the response is heavily weighted towards Yangon and Rakhine at the state and region level, the same is also true at the township level. These 10 townships below are where 76% of all FSC beneficiaries are located:

```{r table-top-townships-beneficiaries}
# check the paragraph text above if you rerun the report on new data 
tsp_ord <- fsc %>%  
  filter(unique_beneficiaries == "Yes") %>% 
  group_by(township) %>% 
  summarise(total_ben = sum(beneficiaries)) %>% 
  mutate(township = case_when(total_ben > 46607 ~ township, 
                              TRUE ~ "Other 141 townships")) %>% 
  group_by(township) %>% 
  summarise_all(.funs = sum) %>% arrange(desc(total_ben))

fsc %>%  
  filter(unique_beneficiaries == "Yes") %>% 
  group_by(township) %>% 
  summarise(HRP_ben = sum(beneficiaries[hrp_ierp == "hrp"]),
            IERP_ben = sum(beneficiaries[hrp_ierp == "ierp"]),
            non_HRP_ben = sum(beneficiaries[hrp_ierp == "non_hrp"]), 
            total_ben = sum(beneficiaries), .groups = "drop") %>% 
  mutate(township = case_when(total_ben > 46607 ~ township, 
                              TRUE ~ "Other 141 townships")) %>% 
  group_by(township) %>% 
  summarise_all(.funs = sum) %>% 
  mutate(`%_of_total_ben` = round(total_ben / sum(total_ben) * 100, digits = 2)) %>% 
  left_join(townships %>% 
              select(state = state_name, township = township_name), by = "township") %>% 
  relocate(state) %>% 
  arrange(desc(total_ben)) %>%
  kbl(caption = "Top 10 townships by beneficiaries reached (desc)", format.args = list(big.mark = ",")) %>% 
  column_spec(6, color = "white", background = spec_color(tsp_ord$total_ben[1:11], end = 0.8, direction = -1)) %>%
  kable_classic_2(lightable_options = c("striped")) %>% 
  footnote(general = "All beneficiaries have been included in 'total_ben', regardless of their inclusion in the HRP/IERP",
           general_title = "")

```

<br>

`r ben %>% select(admin3_pcode) %>% distinct() %>% nrow()` townships overall have been reached by food security activities in 2021, including non-HRP activities. This is `r round(ben %>% select(township) %>% distinct() %>% nrow() / nrow(townships) * 100, digits = 2)`% the 330 townships in the country. `r filter(fsc, hrp_ierp %in% c("hrp", "ierp")) %>% distinct(admin3_pcode) %>% nrow()` townships have been reached by HRP/IERP activities. 

The 2021 HRP was developed using a unit-based costing methodology, based on a formal assessment conducted by FAO/WFP. Targeting was based on the response capacity of FSC partners and costing was based on the average cost of implementation provided by mainly UN agencies and Cluster leads. The 2021 IERP followed a programme-based methodology consisting of scaling the response based on partner-submitted projects, based on orientation and guidance provided by the sectors/clusters. Submitted projects reflected partners' response capacities. 

Even though the IERP was validated by humanitarian partners, it was never enforced by the de-facto authorities. This limited the scope of work and the abilities of humanitarian actors to conduct in-depth vulnerability and needs assessments. It was then decided to treat township-level targets as the PIN in areas where the PIN had not been calculated. Finally, IERP humanitarian assistance also reached non-peri-urban townships for which no targets had been set. 

To momentarily narrow down the focus to the 55 townships with specific HRP or IERP targets, there is substantial variance in the percentage of the target that has been reached. Hlaingtharya's beneficiary figures are 378% of its established target, whereas Hpapun in Kayin and Kyethi in Shan had been targeted since the initial HRP and have not been reached by any FSC activities; additionally, Dagon Myothit (North) and Insein in Yangon and Chanayethazan in Mandalay were targeted in the IERP and also have not been reached.


```{r dataset-ts-target-reached}

ts_target_reached <- pin %>%  
  select(admin3_pcode, state, township, target_2021) %>% 
  filter(target_2021 > 0) %>% 
  left_join(ben %>% 
              group_by(admin3_pcode) %>% 
              summarise(beneficiaries = sum(beneficiaries)), by = "admin3_pcode") %>% 
  mutate(pc_reached = beneficiaries / target_2021 * 100) %>% 
  replace(is.na(.), 0) %>% arrange(desc(pc_reached))


```

Of these 55 townships, there were `r nrow(filter(ts_target_reached, pc_reached > 120))` townships where partners reached more than 120% of their target, `r nrow(filter(ts_target_reached, pc_reached > 100 & pc_reached <= 120))` where they reached between 100% and 119% of their target; `r nrow(filter(ts_target_reached, pc_reached > 80 & pc_reached <= 100))` townships where they reached between 80% and 100% of their target; and `r nrow(filter(ts_target_reached, pc_reached <= 80 & pc_reached != 0))` townships where they reached less than 80% of their target.

<br>

```{r histogram-beneficiaries-hrp-target-reached}

ts_target_reached %>% 
  mutate(pc_reached = ifelse(pc_reached > 200, 200, pc_reached)) %>% 
  ggplot(aes(x = pc_reached)) + 
  geom_histogram(bins = 20) + 
   geom_rect(aes(xmin = 80, xmax = 120, ymin = -0.015, ymax = 11.015),
            fill = "transparent", colour = "goldenrod", size = 0.5) +
  scale_x_continuous(breaks = seq(0, 200, by = 20)) +
  scale_y_continuous(breaks = seq(0, 10, by = 2)) + 
  labs(x = "% of beneficiaries actually reached", 
       y = "Number of townships",
       title = "Distribution of the 55 townships with specific 2021 HRP/IERP targets by reached", 
       subtitle = "Values above 200% have been lumped together at 200%")
```

<br>

The histogram above groups townships based on the percent of their target reached. The percentage reached is on the x-axis and the number of townships is on the y-axis. From a programme management perspective, it would be desirable to see the majority of townships within the yellow box (between 80% and 120% of the target reached), which would indicate the judicious deployment of resources. However, we see that both overreach and under-reaching are very common, with the largest numbers of townships clustered around 0% and 200% or more of the target reached. 

Townships with low levels of achievement question FSC partners' capacities while high levels of overreach suggest that: 

* Assumption 1: the HNO/HRP did not really inform about the real situation in those townships. Indeed, inputs mainly came from UN agencies and Cluster leads. 

* Assumption 2: the context may have changed during the year as the post-coup crisis progressed. 

* Assumption 3: FSC partners have limited capacities to adapt their programming (lack of flexibility and responsiveness). 


<br><br>

### 1.4 Locations

Partners have responded in a total of `r format(ben %>% select(location) %>% distinct() %>% nrow(), big.mark = ",")` locations across the country, with the vast majority of locations only having only one partner operating in them; the maximum number of partners in any location is 4. Of the `r format(fsc %>% nrow(), big.mark = ",")` rows reported in the 5Ws, only `r sum(is.na(fsc$location))` did not report a specific location.

Locations are classified into three groups -- camps, industrial zones and villages/towns/wards:

```{r table-locations}

ben %>% 
  filter(!is.na(location_type)) %>% 
  group_by(location_type) %>% 
  summarise(locations = n_distinct(location),
            townships = n_distinct(township),
            beneficiaries = sum(beneficiaries)) %>% 
  mutate(pc_of_ben = round(beneficiaries / sum(beneficiaries) * 100, digits = 2), 
         avg_ben = round(beneficiaries / locations, digits = 0)) %>%
  arrange(desc(beneficiaries)) %>% 
  kable(caption = "Summary of location types", format.args = list(big.mark = ",")) %>% 
  kable_classic_2() %>% 
  footnote(general = "381,970 beneficiaries were reported in the 211 rows without specific locations",
           general_title = "")
  # pander(caption = "Summary of location types")

```

<br>

The vast majority of locations are served by only one partner. Below are a series of histograms showing the variation in the number of beneficiaries by location, split by number of partners in each location. Locations with one partner present have a large peak around 100 beneficiaries per locations; and a slight majority of locations with two partners have more than 1,000 beneficiaries.

<br>

```{r histogram-locations-by-partner}

fsc %>% 
  filter(!is.na(location)) %>% 
  group_by(location, township) %>%  
  summarise(beneficiaries = sum(beneficiaries), 
            partners = n_distinct(implementing_partners), .groups = "drop") %>% 
  arrange(desc(partners)) %>% 
  ggplot(aes(x = beneficiaries)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(labels = comma, trans = "log10") +
  facet_wrap(~ partners) +
  labs(y = "number of locations",
       x = "beneficiaries per location", 
       title = "Histograms of beneficiaries by location",
       subtitle = "Faceted by number of partners per location")

```


<br>

In general, the more partners operating in a given location, the higher the average number of beneficiaries; however, it should be noted that these multi-partner locations are comparatively rare. The locations with four partners are Nam Hlaing in Bhamo, where it is suspected that the high number of partners is due to beneficiaries from this village participating in a range of activities and trainings held in the township seat, and Momauk Baptist Church, which is a camp location. 

```{r table-locations-partners}
fsc %>% 
  filter(!is.na(location)) %>% 
  group_by(location, township) %>%  
  summarise(beneficiaries = sum(beneficiaries), 
            number_of_partners = n_distinct(implementing_partners), .groups = "drop") %>% 
  group_by(number_of_partners) %>% 
  summarise(locations = sum(n_distinct(location)),
            avg_beneficiaries = median(beneficiaries), .groups = "drop") %>%
  mutate(number_of_partners = recode(number_of_partners, `1` = "one",
                           `2` = "two",
                           `3` = "three",
                           `4` = "four")) %>% 
  kable(caption = "Average beneficiary frequencies in locations with one, two, three and four partners", format.args = list(big.mark = ",")) %>% 
  kable_classic_2(full_width = FALSE, position = "left")
 # pander(caption = "Average beneficiary frequencies in locations with one, two, three and four partners")

```


<br>

When group by number of distinct FSC activities by location, it is observed that a majority of locations had only one FSC activity being implemented there. The spike in number of townships with 3 activities per location were mostly villages and towns in Ayeyarwady and Magway. 

<br>

```{r histogram-locations-by-activities}

fsc %>% 
  filter(!is.na(location)) %>% 
  group_by(location, township) %>%  
  summarise(beneficiaries = sum(beneficiaries), 
            activities = n_distinct(activity, .groups = "drop")) %>% 
  arrange(desc(activities)) %>% 
  ggplot(aes(x = beneficiaries)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(labels = comma, trans = "log10") +
  facet_wrap(~ activities) +
  labs(y = "number of locations",
       x = "Beneficiary frequencies per location", 
       title = "Histograms of number of FSC activities by location",
       subtitle = "Faceted by number of FSC activities per location")

```

<br>

As expected, the higher number of FSC activities in a given location, the higher the number of beneficiary frequencies reached. The tow locations with 5 activities being implemented in them are a camp in Pauktaw and a village in Maungdaw. Once data from other Clusters is obtained, multi-sector coverage and interactions between activities should be explored. 

```{r table-locations-activities}
fsc %>% 
  filter(!is.na(location)) %>% 
  group_by(location, township) %>%  
  summarise(beneficiaries = sum(beneficiaries), 
            number_of_activities = n_distinct(activity), .groups = "drop") %>% 
  group_by(number_of_activities) %>% 
  summarise(locations = sum(n_distinct(location)),
            avg_beneficiary_frequencies = median(beneficiaries), .groups = "drop") %>% 
  mutate(number_of_activities = recode(number_of_activities, `1` = "one",
                           `2` = "two",
                           `3` = "three",
                           `4` = "four", 
                           `5` = "five"),
         avg_beneficiary_frequencies = round(avg_beneficiary_frequencies)) %>% 
  kable(caption = "Average beneficiary frequencies in locations with one, two, three, four and five activities", 
        format.args = list(big.mark = ",")) %>% 
  kable_classic_2(full_width = FALSE, position = "left")
 # pander(caption = "Average beneficiaries by locations with one, two, three and four partners")

```


<br><br><br>

## 2. Activities and modalities

### 2.1 Monthly progress by activity

<br>

```{r line-plot-facet-activity, fig.height=6}
ben %>% 
  group_by(activity) %>% 
  arrange(date) %>% 
  mutate(cum_ben = cumsum(beneficiaries)) %>% 
  ggplot(aes(x = date, y = cum_ben, colour = activity)) +
  geom_line(size = 0.7) +
  geom_vline(colour = "grey50", lty = 2, xintercept = as.numeric(as.Date("2021-06-01"))) +
  scale_x_date(date_breaks = "1 month", date_labels = "%b") +
  scale_y_continuous(labels = comma) +
  facet_wrap(~ activity, scales = "free_y") +
  theme(legend.position = "none",
        axis.text.x = element_text(size = 5)) + # see if this works when you knit, then do it for the other plots 
  labs(x = "Month", 
       y = "Cumulative beneficiaries", 
       title = "Monthly progress by activity, 2021",
       subtitle = "Figures are in cumulative unique beneficiaries reached") + 
  theme(plot.title = element_text(size = 12))

```

<br> 

The plot above shows the FSC's achievements across the eight 5W activities. The majority of the caseload for monthly cash-based transfers was established in early 2021 (with the number of beneficiaries only increasing very incrementally across the course of the year). This highlights two things:

* Many projects contributing to this activity repeat year after year and had just been inserted into the HRP. 

* The operational constraints for the implementation of IERP assistance have pushed FSC partners to resort to more in-kind delivery as opposed to cash-based transfers (CBT), especially in peri-urban areas (Yangon and Mandalay). Cash availability after the coup and "instructions" from the de-facto authorities have limited the use of CBT: 99.7% of IERP beneficiaries in these two regions were reached through the in-kind modality. 

The provision of technical training follows the same pattern (with its caseload being largely established in early 2021) as the IERP did not include this type of activity as it only includes lifesaving activities. 

However, progress over time was also subject to the availability of funds and was also linked to seasonal calendars (i.e. agriculture). These two reasons limit the capacity of the FSC to reach more vulnerable persons. 2.8 million people received food assistance whilst only 500,000 received support for agriculture and livelihood activities. 

It is also difficult to assess the impact of access on the progress of activities over time as many partners use flexible funding or because projects had been modified with donor approval. 


<br><br>

### 2.2 Delivery modalities

Cash and in-kind distributions were each the main delivery modality in three activities. The provision of services and support being predominant in two. The in-kind modality has the highest reach (in terms of beneficiaries), given the especially large beneficiary numbers originating from the provision of monthly food baskets. Several misclassifications e.g. small portions of monthly cash transfers have been coded as "in-kind" and some in-kind food baskets were coded as "cash" and "hybrid". 

For more clarity, it will be worthwhile to better differentiate "support fo income generating activities" and the "provision of technical training" as these are, in many cases, provided in the frame of the same intervention. 

<br>

```{r barplot-facet-activity-modality, fig.height=6}
fsc %>% 
  filter(!is.na(delivery_modality)) %>% 
  group_by(delivery_modality, activity) %>% 
  summarise(beneficiaries = sum(beneficiaries), .groups = "drop") %>%
  mutate(delivery_modality = recode(delivery_modality, 
                                    "Hybrid (In-kind & Cash)" = "Hybrid",
                                    "Service delivery/support" = "Services/support")) %>% 
  ggplot(aes(x = delivery_modality, y = beneficiaries, fill = activity)) +
  geom_col() +
  scale_y_continuous(labels = comma) +
  labs(x = "",
       title = "Delivery modality by activity, 2021",
       subtitle = "Figures are in beneficiary frequencies") + 
  theme(plot.title = element_text(size = 12),
        legend.position = "none", 
        axis.text.x = element_text(angle = 40, hjust = 0.5, vjust = 0.5)) +
  facet_wrap(~ activity, scales = "free_y")

```

<br>

`r round(filter(fsc, delivery_modality == "In-kind") %>% {sum(.$beneficiaries)} / sum(fsc$beneficiaries) * 100)`% of beneficiary frequencies received support through the in-kind service delivery. Beneficiary frequencies are used here as there were several instances of modalities changing partway through an intervention over the course of 2021. `r round(filter(fsc, delivery_modality == "Cash") %>% {sum(.$beneficiaries)} / sum(fsc$beneficiaries) * 100)`% of beneficiary frequencies were reached through cash transfers. However, these overall averages belie how very major differences in the types of delivery modalities employed during the HRP and the IERP. 

With reference to the plot below, HRP beneficiaries were reached with a fairly even split between cash and in-kind modalities. However, under the IERP, the in-kind modality was, by far, the most common delivery mechanism used. This might not be in line with beneficiaries' preferences on delivery mechanisms and may be a reflection of how delivery modalities were impacted by the dynamics of the conflict and the various contextual and administrative constraints. 

<br>

```{r}
fsc %>% 
  filter(!is.na(delivery_modality)) %>% 
  group_by(hrp_ierp, delivery_modality) %>% 
  summarise(beneficiaries = sum(beneficiaries)) %>% 
  ggplot(aes(x = delivery_modality, y = beneficiaries, fill = hrp_ierp)) +
  geom_col(position = "dodge") + 
  scale_fill_viridis_d() +
  scale_y_continuous(labels = comma, breaks = seq(0, 3000000, by = 500000)) +
  labs(x = "Delivery modality", 
       y = "Number of beneficiaries", 
       title = "Beneficiary frequencies by delivery modalities and response plan",
       subtitle = "Figures are in beneficiary frequencies", 
       fill = "")
```


<br>

Regarding the table above, there is a strong argument to remove the option "other" from the 5W column `frequency` (referring to frequency of transfer/delivery). What exactly it connotes is unclear, as partners might elect this option for activities that occur both more and less frequently than every month. There is also the possibility that partners are just electing "other" instead of leaving the column blank.  

<br>


```{r table-modality-frequency}

# changed to beneficiary frequencies instead of unique beneficiaries 
fsc %>% 
  filter(!is.na(delivery_modality)) %>% 
  group_by(delivery_modality, frequency) %>% 
  summarise(beneficiaries = sum(beneficiaries), .groups = "drop") %>% 
  filter(beneficiaries > 0) %>% 
  pivot_wider(names_from = frequency, values_from = beneficiaries) %>% 
  adorn_totals("col", na.rm = TRUE) %>% 
  mutate(`%Total` = round(Total / sum(Total) * 100, digits = 2)) %>% 
  arrange(desc(Total)) %>% 
  adorn_totals("row", na.rm = TRUE) %>% 
  kable(caption = "Beneficiary frequencies by delivery modalities and frequency of distribution", format.args = list(big.mark = ",")) %>% 
  kable_classic_2("striped") %>% 
  footnote(general = "Beneficiary frequencies reported without a delivery modality specified have been excluded", 
           general_title = "")
  # pander(caption = "Beneficiary frequencies by delivery modalities and frequency of distribution")

```

<br>

The "First" category does not really have much relation to the "Monthly" category, i.e. an increase in beneficiaries reported as "First" do not correspond to an increase in "Monthly" beneficiaries in the following months, meaning that these beneficiaries should fall under the "One-off" category. For non-monthly routine activities (agriculture, livelihoods), there is no relation "First" and the "Monthly" categories. 

The column `months_of_food_ration_distributed`, but this column is largely blank and non-NA values have also not been filled well, meaning that a key piece of data -- activity durations -- has not been effectively captured. However, a workaround -- requiring considerable effort, yields the table below, showing the average duration (in months) of the various activities classified as "Monthly" under the `frequency` column:


```{r table-avg-duration-activities}
fsc %>%  
  filter(frequency == "Monthly") %>% 
  group_by(activity, township, location) %>%
  summarise(recurrences = n_distinct(date), .groups = "drop") %>%
  group_by(activity) %>% 
  summarise(avg_duration_months = round(mean(recurrences), digits = 2)) %>% 
  arrange(desc(avg_duration_months)) %>% 
  kable(caption = "Average duration (in months) of monthly activities") %>% 
  kable_classic_2(full_width = FALSE, position = "left") %>%  
  footnote("Only 'monthly' activities included", 
           general_title = "")
  # pander(caption = "Average duration (in months) of monthly activities")
  
```

<br><br>

### 2.3 Monetary values of intervention packages per household

<br>

```{r plot-usd-hhd-bin}
fsc %>% 
  filter(unique_beneficiaries == "Yes" & !is.na(usd_hhd_bin)) %>%
  filter(delivery_modality %in% c("Cash", "Hybrid (In-kind & Cash)", "Voucher")) %>%
  group_by(usd_hhd_bin) %>%  
  summarise(households = sum(households)) %>%
  mutate(`%_of_households` = round(households / sum(households)* 100, digits = 2)) %>% 
  ggplot(aes(x = usd_hhd_bin, y = households, fill = usd_hhd_bin)) +
  geom_col() +
  geom_text(aes(label = `%_of_households`), vjust = -0.5, size = 3) +
  scale_fill_viridis_d(option = "mako", direction = -1) +
  scale_y_continuous(labels = comma, breaks = seq(0, 25000, by = 5000)) +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 30, hjust = 0.8, vjust = 0.9)) +
  labs(x = "USD value of cash transfer per household per month",
       y = "Number of households",
       title = "Number of households by value of cash transfer per household",
       subtitle = "Figures at the top of each bar show percentage of households\nOnly households reached through the cash, hybrid or voucher modalities are included")
```

<br>


The most common transfer values -- in terms of beneficiaries reached -- are between USD 60 and 70, it should also be noted that a not insignificant number of households (about 8%) were reached by cash transfer interventions valued at USD 100 per household or more (usually livelihoods interventions). It should also be noted that 35% of the households who received transfers values at below USD 40/month were the beneficiaries of the "hybrid" delivery modality, and the value of the in-kind goods they received have not been included in this sum as FSC partners have not provided the monetary values of in-kind activities. Please note that these monetary values were calculated only from unique beneficiary households and that these are not the cumulative sums per household.


```{r table-usd-hhd-bin-frequency}
cash_delivery_mechanism <- fsc %>%  
  filter(!is.na(usd_hhd_bin) & unique_beneficiaries == "Yes" & !is.na(cash_delivery_mechanism) ) %>% 
  filter(delivery_modality %in% c("Cash", "Hybrid (In-kind & Cash)", "Voucher")) %>% 
  mutate(households = round(households)) %>% 
  group_by(cash_delivery_mechanism) %>% 
  summarise(beneficiaries = sum(beneficiaries), 
            households = sum(households)) %>% 
  mutate(pc_of_hhd = round(households / sum(households) * 100, digits = 2),
         pc_of_ben = round(beneficiaries / sum(beneficiaries) * 100, digits = 2)) %>% 
  relocate(pc_of_ben, .after = beneficiaries) %>% 
  arrange(desc(households))

cash_delivery_mechanism %>% 
  kable(caption = "Cash transfer, hybrid and voucher values per household, by cash delivery mechanism (USD)", 
        format.args = list(big.mark = ",")) %>% 
  kable_classic_2(lightable_options = "striped", position = "left", full_width = FALSE) %>% 
  footnote(general = "Only households which were reached by cash, hybrid or voucher modalities are included", 
           general_title = "")
# pander(caption = "Cash transfer, hybrid and voucher values per household by cash delivery mechanism (USD)")

```

<br>

By far the most common cash delivery mechanism was direct cash payments -- `r filter(cash_delivery_mechanism, cash_delivery_mechanism == "Direct cash payment") %>%  pull(pc_of_hhd)`% of households were reached through this mechanism. Transfers made through Money transfer agents had the highest average transfer amount. 



This next section highlights household package values by activity type:

```{r table-usd-values-activity}
avg_transfer_value <- fsc %>% 
  filter(delivery_modality %in% c("Cash", "Hybrid (In-kind & Cash)", "Voucher")) %>%
  filter(new_value_hhd < 1000) %>% 
  group_by(activity) %>% 
  summarise(hhd_frequencies = round(sum(households, na.rm = TRUE)),
            total_value_usd = round(sum(total_value_usd, na.rm = TRUE))) %>% 
  mutate(avg_transfer_value = round(total_value_usd / hhd_frequencies, digits = 2)) %>% 
  arrange(desc(avg_transfer_value)) 

avg_transfer_value %>%  
  kable(caption = "Average value (USD) of household package values per activity", 
        format.args = list(big.mark = ",")) %>% 
  kable_classic_2(lightable_options = "striped") %>% 
  column_spec(4, color = "white", background = spec_color(avg_transfer_value$avg_transfer_value[1:7], end = 0.8, direction = -1)) %>%
  footnote(general = "Only households which were reached by cash, hybrid or voucher modalities are included; extreme values filtered out", 
           general_title = "")
# pander(caption = "Average value (USD) of household package values per activity")
  
```

<br>

Overall, the highest average cash transfers were from the provision of livestock kits and the lowest averages from Cash for work/food for assets activities (after filtering out food baskets reported as cash). Please also note that for the table above, all per-household values above USD 1000 per transfer have been filtered out as they are likely errors as they only pertain to cash for work / food for assets and monthly cash-based transfers. 

These extreme values have not been filtered out for the table below of summary statistics for the different package values per activity. Of note, the standard deviations for cash for work/food for assets and income-generating activities are very high in comparison to the mean: both of these have extreme outliers in terms of package values.  

```{r table-summary-statistics-monetary values}
fsc %>% 
  filter(!is.na(new_value_hhd)) %>% 
  filter(unique_beneficiaries == "Yes") %>%
  filter(delivery_modality %in% c("Cash", "Hybrid (In-kind & Cash)", "Voucher")) %>%
  group_by(activity) %>% 
  summarise(households = sum(households),
            mean = mean(new_value_hhd),
            median = median(new_value_hhd), 
            sd = sd(new_value_hhd), 
            aad = mad(new_value_hhd)) %>% 
  mutate(across(c(mean, median, sd, aad), ~ round(., digits = 2))) %>% 
  arrange(desc(mean)) %>% 
  kable(caption = "Summary statistics of monetary values by activity;\ncontains only data from activities using cash, hybrid or voucher modalities") %>% 
  kable_classic_2("striped") %>% 
  footnote(general = "SD (standard deviation), AAD (average absolute deviation); extreme values not filtered out", general_title = "")
```

<br>

But average package values are only part of the picture and significant variation in transfer values exists within each activity. Clear majorities of the households who benefited form cash transfers received values of between USD 60-70, while those who benefited from crop and vegetable kits received values between USD 50-60. This suggests that these activities could relatively standardised. 

<br>

```{r barplot-facet-usd-hhd-bin-activity, fig.height=7}
fsc %>% 
  filter(!is.na(usd_hhd_bin) & unique_beneficiaries == "Yes") %>% 
  filter(delivery_modality %in% c("Cash", "Hybrid (In-kind & Cash)", "Voucher")) %>%
  group_by(activity, usd_hhd_bin) %>% 
  summarise(households = sum(households)) %>% 
  ggplot(aes(x = usd_hhd_bin, y = households, fill = activity)) +
  geom_col() +
  scale_y_continuous(labels = comma) +
  labs(x = "") +
  labs(title = "Variation in the per household values of intervention packages in USD", 
       subtitle = "Faceted by activity; contains only data from activities using cash, hybrid or voucher modalities") +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 90, vjust = 0.5), 
        plot.title = element_text(size = 12)) +
  facet_wrap(~ activity, scales = "free_y")

```

<br>

In this section, the FSC has tried to work around several data entry errors in the 5W reporting -- the per household values of cash transfers have been recalculated using the number of households reached and the total value (in USD) of the cash transfers provided. Going forward, it is necessary to review and confirm these errors with partners and clean the 5W dataset as many of them have recorded cash transfer values of around USD 10.50 per household as opposed to our recalculated value which averages out at USD `r round(fsc %>% filter(value_per_household_usd == 10.5) %>% {median(.$new_value_hhd)}, digits = 2)`; it is suspected that the per beneficiary value may have been entered as opposed to the value per household. 

These recalculated values have been used in the plot below, which summarises the per household per month value of the top 5 implementing (by beneficiaries reached) partners by activity, excluding livestock and fishery kits, which, as mentioned, do not have as much variation as the other activities:

<br>

```{r facet-usd-package-by-activity}
fsc %>% 
  filter(unique_beneficiaries == "Yes" & !is.na(usd_hhd_bin)) %>%
  filter(delivery_modality %in% c("Cash", "Hybrid (In-kind & Cash)", "Voucher")) %>%
  filter(activity %out% c("Provide fishery kits", "Provide livestock kits")) %>% 
  filter(new_value_hhd < 700 & activity != "Provide monthly food baskets") %>% 
  group_by(activity, implementing_partners) %>% 
  summarise(mean_usd = mean(new_value_hhd), 
            beneficiaries = sum(beneficiaries), 
            households = sum(households)) %>% 
  arrange(desc(beneficiaries)) %>% 
  mutate(mean_usd = ifelse(activity == "Provide monthly cash-based transfers", mean_usd / (beneficiaries / households), mean_usd	)) %>% 
  top_n(5) %>% 
  ggplot(aes(x = mean_usd, y = implementing_partners, fill = activity)) +
  scale_x_continuous(labels = comma_format(accuracy = 1)) +
  geom_col() + 
  facet_wrap(~ activity, scales = "free", ncol = 2) +
  theme(legend.position = "none", 
        axis.text.y = element_text(size = 7)) +
  labs(x = "Average USD value of package per transfer", 
       y = "Implementing partner", 
       title = "Top 5 partners (by beneficiaries) and their packages by activity type", 
       subtitle = "Only includes activities reported under cash, hybrid and voucher modalities;\nAll values are per month per household, except cash transfers which are per person")


```

<br>

The table below compares the different bins for cash-transfer values to the minimum expenditure basket for food established by the Cash Working Group (CWG) -- they have set a floor of MMK 190,555 (or USD 114.55) per household per month:


```{r table-meb-usd-hhd-bin}
cbt_bins <- fsc %>% filter(activity == "Provide monthly cash-based transfers" & !is.na(usd_hhd_bin)) %>%
  count(usd_hhd_bin, wt = households) %>% 
  mutate(pc_of_total = round(n / sum(n) * 100, digits = 2))

fsc %>% 
  filter(unique_beneficiaries == "Yes" & activity == "Provide monthly cash-based transfers") %>% 
  filter(!is.na(new_value_hhd)) %>% 
  mutate(pc_meb = new_value_hhd / 114.55) %>% 
  group_by(usd_hhd_bin) %>% 
  summarise(avg_pc_of_meb = round(median(pc_meb) * 100, digits = 2),
            avg_usd_month = round(median(new_value_hhd, na.rm = TRUE), digits = 2),
            households = round(sum(households))) %>% 
  mutate(pc_of_hhd = round(households / sum(households) * 100, digits = 2)) %>% 
  kable(caption = "Monthly cash-based transfer values by percentage of MEB received", format.args = list(big.mark = ",")) %>% 
  kable_classic_2("striped") %>% 
  column_spec(5, color = "white", background = spec_color(cbt_bins$pc_of_total[1:11], end = 0.9, direction = -1)) %>%
  footnote(general = "Only households reached through monthly cash-based transfers are included",
           general_title = "")
# pander(caption = "Monthly cash-based transfer values by percentage of MEB received")

```

<br>

Overall, `r round(filter(fsc, new_value_hhd > (114.55/2) & unique_beneficiaries == "Yes" & activity == "Provide monthly cash-based transfers") %>% {sum(.$beneficiaries)} / filter(fsc, !is.na(new_value_hhd) & unique_beneficiaries == "Yes" & activity == "Provide monthly cash-based transfers") %>% {sum(.$beneficiaries)} * 100, digits = 2)`% of beneficiary households of cash-based transfers have received 50% or more of the MEB for the months they were covered. 

It is important to keep in mind that humanitarian assistance aims to cover acute needs and that full/half rations are not necessarily intended to cover the full MEB and are instead focused on providing, totally or partially, 2,100 kcal/day per person each month. However, it is beneficial for the FSC to collect information about the percentage of the MEB that cash transfers and food basket distributions are intended to achieve. 

<br><br><br>

## 3. Partners

The total number of FSC partners is 71, with the following breakdown: 

```{r table-all-fsc-partners}
tribble(
  ~type, ~count, 
  "UN (including OCHA)", 3,
  "INGO", 25,
  "NNGO, CSO and Private sector", 41, 
  "Research institutes", 2, 
  "Total FSC partners", 71
) %>% 
  kable(caption = "FSC partners by type") %>% 
  kable_classic_2(position = "left", full_width = FALSE) %>% 
  row_spec(5, bold = TRUE)
```

<br>

To follow-up on the food security situation in Myanmar and to provide valuable data and analysis to inform partners' food security strategies and programming, the FSC is diversifying its network of partners. Even though not all of them are reporting achievements in the 5Ws. 

A total of `r fsc %>% select(implementing_partners) %>% distinct() %>% nrow()` FSC partners classified themselves as implementing partners within the 5Ws. They are fairly evenly split themselves between HRP indicators, with `r fsc %>% filter(str_detect(hrp_indicator, "1.")) %>% select(implementing_partners) %>% distinct() %>% nrow()` contributing towards food and cash assistance and `r fsc %>% filter(str_detect(hrp_indicator, "2.")) %>% select(implementing_partners) %>% distinct() %>% nrow()` contributing towards agriculture and other livelihood support. `r ben %>% sum_ben(implementing_partners) %>% filter(beneficiaries < 10000) %>% nrow()` partners have reached less than 10,000 unique beneficiaries and the median unique beneficiaries reached by partners is `r ben %>% sum_ben(implementing_partners) %>% {median(.$beneficiaries)} %>% format(big.mark = ",")`. Below are the top 10 partners by HRP indicator.

```{r table-top-partners-by-hrp-indicator}

# reminder to redo the numbers when you rerun this with fresh data 

cbind(
  
  fsc %>% 
    filter(hrp_indicator == "1.Number of people who received food and/or cash assistance" &
             beneficiaries_recurrency %in% c("First", "One-off")) %>% 
    group_by(implementing_partners) %>% 
    summarise(beneficiaries = sum(beneficiaries)) %>% 
    arrange(desc(beneficiaries)) %>% 
    rename(`1. Number of people who received food and/or cash assistance` = beneficiaries,
           `Partners HRP indicator1` = implementing_partners) %>% 
    head(10),
  
  fsc %>% 
    filter(hrp_indicator == "2.Number of people who received agriculture and other livelihood support" &
             beneficiaries_recurrency %in% c("First", "One-off")) %>% 
    group_by(implementing_partners) %>% 
    summarise(beneficiaries = sum(beneficiaries)) %>% 
    arrange(desc(beneficiaries)) %>% 
    rename(`2. Number of people who received agriculture and other livelihood support` = beneficiaries,
           `Partners HRP indicator2` = implementing_partners) %>% 
    head(10)
  
) %>% 
  add_column(` ` = " ") %>% 
  relocate(` `, .after = `1. Number of people who received food and/or cash assistance`) %>% 
  
  kable(caption = "Top 10 implementing partners by beneficiaries reached, by HRP indicator", format.args = list(big.mark = ",")) %>% 
  kable_classic_2("striped") %>%  
  footnote(general = "Figures reflect beneficiaries reached through direct implementation",
           general_title = "")
# pander(caption = "Top 10 partners by beneficiaries reached, by HRP indicator")

```

<br><br>

### 3.1 Distribution of partners by beneficiaries and geographic reach

Whilst there is quite a bit of variation in the number of beneficiaries reached, FSC partners' geographic footprints are quite limited. Only `r ben %>% group_by(implementing_partners) %>% summarise(townships = n_distinct(admin3_pcode)) %>% filter(townships > 10) %>% nrow()` partners have a presence in more than 10 townships, and only `r ben %>% group_by(implementing_partners) %>% summarise(townships = n_distinct(admin3_pcode)) %>% filter(townships > 5) %>% nrow()` are present in more than 5 townships. 78% of FSC partners (clustered along the bottom of the chart) are present in 5 or less townships. This distribution of partners is an impediment to a countrywide response and it is imperative to understand how:

* To incentivise partners to expand their footprints

* the FSC can identify new partners to reach vulnerable persons in areas recently affected by conflict

* To encourage donors to support expansion of Food Security activities in areas recently affected by conflict (with sufficient support costs)

<br>

```{r plotly-scatter-partners-reach}
# reminder to recalculate the 78% above if you rerun the data 
partner_scatter <- ben %>% 
  group_by(implementing_partners) %>% 
  summarise(states = n_distinct(admin1_pcode),
            townships = n_distinct(admin3_pcode),
            beneficiaries = sum(beneficiaries)) %>% 
  arrange(desc(states)) %>% 
  ggplot(aes(x = beneficiaries, y = townships, text = implementing_partners)) +  
  geom_point(aes(size = beneficiaries)) +
  scale_x_continuous(trans = "log", labels = comma, breaks = c(0, 100, 1000, 10000, 100000, 300000)) +
  scale_y_continuous(breaks = seq(0, 30, 5)) +
  labs(x = "Number of beneficiaries",
       y = "Number of townships",
       title = "Plot of beneficiaries and townships reached, by implementing partner") +
  theme(legend.position = "none")
# for some reason, removing this messes with the alignment of the plot

ggplotly(partner_scatter) %>%
  config(displayModeBar = FALSE) %>% 
  layout(title = list(text = paste0("Plot of beneficiaries and townships reached, by implementing partner",
                                    "<br>", 
                                    "<sup>",
                                    "mouse over for details",
                                    "</sup>")))

```

<br>

```{r df-act-num}
act_num <- fsc %>% 
  group_by(implementing_partners) %>% 
  summarise(number_of_activities = n_distinct(activity), 
            beneficiaries = sum(beneficiaries[unique_beneficiaries == "Yes"], na.rm = TRUE)) %>%  
  group_by(number_of_activities) %>% 
  summarise(partners = n_distinct(implementing_partners),
            beneficiaries = sum(beneficiaries)) %>% 
  mutate(pc_of_beneficiaries = round(beneficiaries / sum(beneficiaries) * 100, digits = 2))

```

In terms of activities, `r filter(act_num, number_of_activities == 1) %>% pull(partners)` partners (`r round(filter(act_num, number_of_activities == 1) %>% pull(partners) / distinct(fsc, implementing_partners) %>% nrow() * 100)`% of partners reporting in 5Ws) are implementing only one type of activity. Only one partner (World Vision Myanmar) is responding across 6 activities. This  indicates that the food security support provided to beneficiaries is far from comprehensive and does not help beneficiaries achieve a sustainable and clear positive food security status. 


```{r table-act-num}
act_num %>% 
  kable(caption = "Number of implementing partners by number of distinct activities being implemented",
        format.args = list(big.mark = ",")
        #,table.attr = "style='width:50%;'"
        ) %>% 
  kable_classic_2(position = "left", full_width = FALSE)
# pander(caption = "Number of implementing partners by number of distinct activities being implemented")
```

<br><br>

### 3.2 Monthly progress by partner

<br>

```{r partners-progress-over-time-facet}
partner_top <- ben %>%  
  sum_ben(implementing_partners) %>% arrange(desc(beneficiaries)) %>% pull(implementing_partners) %>% head(20)

ben %>% 
  filter(implementing_partners %in% partner_top) %>% 
  group_by(implementing_partners) %>% 
  arrange(date) %>% 
  mutate(cum_ben = cumsum(beneficiaries)) %>%
  mutate(implementing_partners = fct_reorder(implementing_partners, cum_ben, max, .desc = TRUE)) %>%  
  ggplot(aes(x = date, y = cum_ben)) +
  geom_line(size = 0.5) + 
  scale_x_date(date_breaks = "1 month", date_labels = "%b") +
  scale_y_continuous(labels = comma) +
  geom_vline(colour = "red", lty = 2, xintercept = as.numeric(as.Date("2021-06-01"))) +
  facet_wrap(~ implementing_partners, scales = "free_y") +
  theme(legend.position = "none",
        axis.text.x = element_text(size = 3.5),
        axis.text.y = element_text(size = 4),
        strip.text = element_text(size = 4.5, face = "bold")) + # see if this works when you knit, then do it for the other plots 
  labs(x = "Month", 
       y = "Cumulative beneficiaries", 
       title = "Monthly progress of top 20 implementing partners, 2021", 
       subtitle = "Figures show cumulative unique beneficiaries") + 
  theme(plot.title = element_text(size = 11))
```

 <br>
 
The plot above shows the top 20 partners by number of beneficiaries reached in 2021, with the red line indicating June 2021, when the IERP was approved and published. Overall, the IERP had a very large effect on the number of beneficiaries reached. Most partners enacted a significant ramp up and reached the majority of beneficiaries after it was published. Exceptions to this include organisations such as CESVI, Helen Keller International, Save the Children and Myanmar Heart Development Organisation, who established most of their caseload prior to July 2021. The next chapter will explore the effect the IERP had on persons reached by beneficiary type. Progress is also subject to the availability of funds and are also linked to seasonal calendars (e.g. agriculture). 


<br><br>

### 3.3 Types of implementing partners

```{r table-implementing-partner-type, warning=FALSE}
fsc %>% 
  filter(unique_beneficiaries == "Yes") %>% 
  group_by(implementing_partner_type, implementing_partners) %>%  
  summarise(beneficiaries = sum(beneficiaries), 
            townships = n_distinct(admin3_pcode),
            states = n_distinct(admin1_pcode), .groups = "drop") %>% 
  group_by(implementing_partner_type) %>% 
  summarise(avg_beneficiaries = round(mean(beneficiaries)),
            avg_townships = round(mean(townships), digits = 2), 
            avg_states = round(mean(states), digits = 2), 
            .groups = "drop") %>%  
  mutate(implementing_partner_type = fct_relevel(implementing_partner_type, levels = c("INGO", "NNGO", "UN", "other"))) %>% 
  kable(caption = "Average reach by implementing partner type", format.args = list(big.mark = ",")) %>% 
  kable_classic_2() %>% 
  footnote(general = "Figures are averages reached by direct implementation", general_title = "")
  # pander(caption = "Average reach by implementing partner type")

```

<br>
NNGOs, on average, tended to reach more beneficiaries than INGOs, though INGOs tended to have a much wider geographic reach than NNGOs, perhaps due to them having more sub-offices. There is only one agency mentioned under the "UN" category -- WFP. The "other" category refers to two private limited companies which also implemented food security activities.

<br><br>

### 3.4 Reporting organisations

Once the instances where the reporting organisation and the implementing partner were the same organisation were filtered out, all the remaining implementing partners correspond to just `r fsc %>% filter(reporting_organization != implementing_partners) %>% distinct(reporting_organization) %>% nrow()` reporting organisations:

```{r table-reporting-organisation}
fsc %>% 
  filter(reporting_organization != implementing_partners) %>% 
  group_by(reporting_organization) %>% 
  summarise(implementing_partners = n_distinct(implementing_partners)) %>% 
  arrange(desc(implementing_partners)) %>% 
  kable(caption = "Number of implementing partners by reporting organisation") %>% 
  kable_classic_2("striped", full_width = FALSE, position = "left")
# pander(caption = "Number of implementing partners by reporting organisation")
```

<br>

This report has used `implementing_partners` for most of the analysis as, by their nature, reporting organisations do not necessarily have a field presence. As a side note, FAO has not been classified as an implementing partner. No direct implementation was reported by them. 

<br><br>


### 3.5 Donors

`r round(sum((!is.na(fsc$donor))) / nrow(fsc) * 100, digits = 0)`% of the rows had the `donor` column filled. However, this only represents activities reaching 23% of all beneficiaries. Below is a table of the 10 donors (after organisations using their own resources) whose funding  has reached the most beneficiaries and the number of townships their funding has been used in:

```{r donor-table}
fsc %>% 
  filter(unique_beneficiaries == "Yes") %>% 
  group_by(donor) %>% 
  summarise(beneficiaries = sum(beneficiaries),
            townships = n_distinct(admin3_pcode)) %>% 
  mutate(pc_of_ben = round(beneficiaries / sum(beneficiaries) * 100, digits = 2)) %>% 
  relocate(pc_of_ben, .after = beneficiaries) %>% 
  filter(!is.na(donor)) %>% 
  arrange(desc(beneficiaries)) %>% 
  head(11) %>% 
  kable(caption = "Top 10 donors by number of beneficiaries reached with their funding", format.args = list(big.mark = ",")) %>% 
  kable_classic_2(lightable_options = c("striped")) %>% 
  footnote(general = "77% of all beneficiaries (2,513,026 persons) were reported with the `donor` column left blank", general_title = "")
# pander(caption = "Top 10 donors by number of beneficiaries reached with their funding")
```

<br>

Additionally, numerous errors have also been observed, including cases where multiple donors have been combined into one row as well as numerous instances where UNDP, WFP, FAO and UN WOMEN were classified as donors as opposed to reporting organisations. Helvetas should also probably have reported under "organisations using their own funds". 

<br><br><br>

## 4. Beneficiaries

### 4.1 Beneficiary disaggregation

Currently, in the 5Ws, the vast majority of beneficiary diasaggregations have been backfilled from census data and do not, consequently, provide an accurate picture of the population that have been reached by Food Security interventions. It is not possible to determine how far reality diverges from what has been reported so far -- meaning that it cannot be determined if there has been any bias in beneficiary selection and targeting. It is imperative to begin collecting disaggregated beneficiary data from partners.

Most FSC partners only report the age and sex of the specific person receiving the assistance (not necessarily the head of household). The FSC and donors expect complete reporting of gender and age compositions of beneficiary households. 

It is possible that partners are collecting this data. Disaggregated beneficiary data is commonly needed for internal and external reporting. The FSC will work with its partners to strengthen their data collection system to ensure that reported data meets international standards. 

```{r df-fsc-disagg}
# tribble for the disaggregation proportions used -- moved below so I don't read another thing into the environment 
# full_disagg <- tribble(
#   ~age, ~sex, ~disagg, ~value, 
#   "child", "male", "child_male", 0.162989989,
#   "child", "female", "child_female", 0.158900883,
#   "adult", "male", "adult_male", 0.271450831,
#   "adult", "female", "adult_female", 0.300444585,
#   "elderly", "male", "elderly_male", 0.044029423,
#   "elderly", "female", "elderly_female", 0.06218429
# )

# helper_disagg <- tribble(
#   ~disagg, ~value,
#   "child", 0.321890872,
#   "adult", 0.571895416,
#   "older", 0.106213712, 
#   "helper_male", 0.478470242,
#   "helper_female", 0.521529758
# )

fsc_disagg <- fsc %>% 
  pivot_longer(cols = c(child_male:elderly_female), names_to = "disagg", values_to = "ben_sub") %>% 
  left_join(tribble(
    ~age, ~sex, ~disagg, ~value, 
    "child", "male", "child_male", 0.162989989,
    "child", "female", "child_female", 0.158900883,
    "adult", "male", "adult_male", 0.271450831,
    "adult", "female", "adult_female", 0.300444585,
    "elderly", "male", "elderly_male", 0.044029423,
    "elderly", "female", "elderly_female", 0.06218429
    ) %>% 
              select(disagg, census_prop = value), by = "disagg") %>%
  filter(ben_sub != 0) %>% 
  mutate(ben_prop = ben_sub / beneficiaries, 
         ben_prop_compare = abs(census_prop - ben_prop),
         same_as_census = ifelse(ben_prop_compare < 0.05, "backfilled", "real"))

fsc_disagg_values <- fsc_disagg %>% 
  filter(unique_beneficiaries == "Yes") %>% 
  group_by(same_as_census) %>% 
  summarise(ben_sub = sum(ben_sub)) %>% 
  adorn_percentages("col") %>% 
  mutate(ben_sub = round(ben_sub * 100, digits = 2))

```


It is estimated that `r filter(fsc_disagg_values, same_as_census == "backfilled") %>% pull(ben_sub)`% of beneficiaries reported in the 5Ws have been "disaggregated" by backfilling values from the census. This has been calculated by comparing the proportions of age and sex disaggregations to the national values set out in the 2021 population projections -- values within 5% of the national proportions have been considered as backfilled from the census. 

The plot below shows the differences between the breakdown of beneficiaries by disaggregation group when only considering values that have not been backfilled from the census against all values reported in the 5W dataset. This corresponds to `r filter(fsc_disagg_values, same_as_census == "real") %>% pull(ben_sub)`% of reported beneficiaries. It can be observed that adult females are actually the largest group of beneficiaries when looking at "actual" values. Additionally, the proportions of the beneficiary population who are elderly are far lower than what has been reflected in the majority of data reported in the 5Ws. 

<br>

```{r barplot-real-disagg-breakdown}
fsc_disagg %>%
  filter(unique_beneficiaries == "Yes") %>% 
  filter(same_as_census == "real") %>% 
  group_by(disagg) %>% 
  summarise(ben_freq = sum(ben_sub)) %>% 
  mutate(disagg = fct_relevel(disagg, 
                              c("child_male", "child_female", "adult_male", "adult_female", "elderly_male", "elderly_female")
                              # c("elderly_female", "elderly_male", "adult_female", "adult_male", "child_female", "child_male")
                              )) %>% 
  adorn_percentages("col") %>% 
  ggplot(aes(x = disagg, y = ben_freq, fill = disagg)) + 
  geom_col() + 
  geom_text(aes(label = round(ben_freq * 100, digits = 1)), size = 3, vjust = -0.3) +
  scale_y_continuous(labels = percent, breaks = seq(0, 0.4, by = 0.1)) +
  labs(x = "Disaggregation group", 
       y = "Percentage of beneficiaries",
       title = "% of beneficiaries by disaggregation group", 
       subtitle = "Only contains real* values; 44% of beneficiaries") +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 60, hjust = 1)) + 
  
fsc_disagg %>% 
  filter(unique_beneficiaries == "Yes") %>% 
  # filter(same_as_census == "backfilled") %>% 
  group_by(disagg) %>% 
  summarise(ben_freq = sum(ben_sub)) %>% 
  mutate(disagg = fct_relevel(disagg, 
                              c("child_male", "child_female", "adult_male", "adult_female", "elderly_male", "elderly_female")
                              # c("elderly_female", "elderly_male", "adult_female", "adult_male", "child_female", "child_male")
                              )) %>% 
  adorn_percentages("col") %>% 
  ggplot(aes(x = disagg, y = ben_freq, fill = disagg)) + 
  geom_col() + 
  geom_text(aes(label = round(ben_freq * 100, digits = 1)), size = 3, vjust = -0.3) +
  scale_y_continuous(labels = percent, breaks = seq(0, 0.4, by = 0.1)) +
  labs(x = "Disaggregation group", 
       y = "Percentage of beneficiaries",
       title = "% of beneficiaries by disaggregation group", 
       subtitle = "Contains all values, including backfilled values") +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 60, hjust = 1))
  
```
 
 <br>
 
This was confirmed by examining the distributions of beneficiary disaggregations by implementing partner. From the plot below, it is observed that the majority of disaggregated values were very close to the mean for the entire group. To explain: if partner A reported that 40% of the beneficiaries of an activity were adult females, this percentage was then compared to the mean percentage of beneficiaries formed by adult females for all the other activities reported by that partner. This measures whether or not the same proportions were just copied and pasted throughout the 5W beneficiary disaggregation columns -- it is extremely unlikely that these percentages would be similar across activities as implementing partners worked in an average of `r round(fsc %>% group_by(implementing_partners) %>% summarise(locations = n_distinct(location)) %>% {mean(.$locations)}, digits = 2)` locations. This level of variability is much lower than what exists in the general population. 

<br>

```{r density-plot-disaggregation}
fsc_disagg %>% 
  filter(unique_beneficiaries == "Yes") %>% 
  mutate(pc_disagg = ben_sub / beneficiaries) %>% 
  group_by(implementing_partners, disagg) %>% 
  summarise(mean = mean(pc_disagg), 
            sd = sd(pc_disagg, na.rm = TRUE),
            ben_sub = sum(ben_sub, na.rm = TRUE)) %>% 
  ggplot(aes(x = sd, fill = disagg)) +
  geom_density(position = "stack", adjust = 0.5) +
  scale_fill_manual(values = c("#00BFC4", "#00BA38", "#B79F00", "#F8766D", "#619CFF", "#F564E3")) + 
  scale_x_continuous(labels = percent_format(accuracy = 1)) +
  labs(x = "Percentage difference from group mean",
       title = "Density plot of standard deviations across beneficiary disaggregations",
       subtitle = "The lower the standard deviation, the closer the value to the group mean",
       fill = "") +
  theme(legend.position = c(0.9, 0.75))
 
```


<br><br>

### 4.2 Types of beneficiaries

```{r beneficiary-type-dataset}
ben_type <- fsc %>% 
  filter(!is.na(beneficiary_type) & unique_beneficiaries == "Yes") %>% 
  group_by(beneficiary_type) %>% 
  summarise(beneficiaries = sum(beneficiaries), .groups = "drop") %>%
  adorn_percentages(denominator = "col", na.rm = TRUE) %>% 
  mutate(beneficiaries = round(beneficiaries * 100, digits = 2))
```

Overall, `r ben_type %>% filter(beneficiary_type == "Host/local Community") %>% pull(beneficiaries)`% of beneficiaries are from the host/local community, `r ben_type %>% filter(beneficiary_type == "Rakhine stateless") %>% pull(beneficiaries)`% are stateless persons from Rakhine and `r ben_type %>% filter(beneficiary_type == "Internally Displaced") %>% pull(beneficiaries)`% are IDPs. Returnees are the rarest type of beneficiary reached, forming only `r ben_type %>% filter(beneficiary_type == "Returnees") %>% pull(beneficiaries)`% of all beneficiaries reached.

```{r table-ben-type}
fsc %>%  
  filter(!is.na(beneficiary_type) & unique_beneficiaries == "Yes") %>% 
  group_by(hrp_ierp, beneficiary_type) %>% 
  summarise(beneficiaries = sum(beneficiaries), .groups = "drop") %>% 
  pivot_wider(names_from = hrp_ierp, values_from = beneficiaries)  %>% 
  adorn_totals("col") %>% 
  mutate(pc_of_ben = round(Total / sum(Total) * 100, digits = 2)) %>% 
  rename(total_beneficiaries = Total) %>% 
  kable(caption = "Breakdown of beneficiary types by response plan", format.args = list(big.mark = ",")) %>% 
  kable_classic_2()
  
```



<br>

The states and regions in which the FSC is working the most with IDPs are Chin, Kachin, Sagaing and Shan (North) and Kayah:  

```{r table-beneficiary-types-state}
fsc %>% 
  filter(!is.na(beneficiary_type) & unique_beneficiaries == "Yes") %>% 
  group_by(state, beneficiary_type) %>% 
  summarise(beneficiaries = sum(beneficiaries), .groups = "drop") %>%  
  pivot_wider(names_from = beneficiary_type, values_from = beneficiaries) %>% 
  adorn_totals(where = "row", na.rm = TRUE) %>% 
  adorn_percentages(denominator = "row", na.rm = TRUE) %>% 
  mutate(across(-state, ~ round(. * 100, digits = 2))) %>% 
  left_join(fsc %>% 
              filter(!is.na(beneficiary_type) & unique_beneficiaries == "Yes") %>%
              sum_ben(state), by = "state") %>% 
  kable(caption = "Percentage breakdown of beneficiary types by state/region", format.args = list(big.mark = ",")) %>% 
  kable_classic_2(lightable_options = "striped") %>%  
  footnote("Each row in the table shows the percentage of each beneficiary type within each state/region",
           general_title = "")
# pander(caption = "Percentage breakdown of beneficiary types by state/region")

```

<br>

Compared to only the 2021 HRP targets (as the IERP does not have breakdowns of the target by beneficiary type), beenficiary type targets have been mostly exceeded, neither the targets for returnees/resettled in Kachin or Shan (North) nor targets for IDPs in Rakhine have been met. Interestingly, for Rakhine, the targets for the host/local population have been greatly exceeded and various assumptions can be formulated regarding this:

* There was better integration of the host population into relief programming
* There was sufficient availability of funds to cover the food needs of IDPs
* The relative stability of the Rakhine state context discourages donors from supporting emergency relief activities for the stateless population there 
* Funds from development donors are also available in Rakhine state

In Bago (East), Chin, Kayin and particularly Shan (North), the targets for IDPs have been greatly exceeded, in comparison to the 2021 HRP targets.

```{r table-beneficiary-type-reached-hrp-target}
# reminder to check the text in the paragraph above when you rerun the report with data
pin %>%
  filter(hrp_target_total > 0) %>% 
  select(state, admin3_pcode, hrp_target_idps_2021, hrp_target_returnees_2021, hrp_target_stateless_rakhine_2021, 
                     hrp_target_other_vulnerable_2021, hrp_target_total) %>% 
  left_join(fsc %>% 
            filter(!is.na(beneficiary_type) & unique_beneficiaries == "Yes" & hrp_ierp != "non_hrp") %>% 
  group_by(admin3_pcode, beneficiary_type) %>% 
  summarise(beneficiaries = sum(beneficiaries), .groups = "drop") %>%
  pivot_wider(names_from = beneficiary_type, values_from = beneficiaries) %>% 
  mutate(total_beneficiaries = rowSums(across(where(is.numeric)), na.rm = TRUE)), by = "admin3_pcode") %>% 
  clean_names() %>%
  replace(is.na(.), 0) %>% 
  group_by(state) %>% 
  summarise_at(vars(hrp_target_idps_2021:total_beneficiaries), ~sum(.)) %>% 
  mutate(host_local_pc = host_local_community / hrp_target_other_vulnerable_2021 * 100, 
         idp_pc = internally_displaced / hrp_target_idps_2021 * 100,
         returnees_pc = returnees / hrp_target_returnees_2021 * 100,
         rakhine_stateless_pc = rakhine_stateless / hrp_target_stateless_rakhine_2021 * 100,
         total_pc = total_beneficiaries / hrp_target_total * 100) %>% 
  select(state, host_local_pc, idp_pc, returnees_pc, rakhine_stateless_pc, total_pc) %>%
  mutate_at(vars(host_local_pc, idp_pc, returnees_pc, rakhine_stateless_pc, total_pc), ~ replace(., is.nan(.), NA)) %>%
  mutate_at(vars(host_local_pc, idp_pc, returnees_pc, rakhine_stateless_pc, total_pc), ~ replace(., is.infinite(.), NA)) %>%
  mutate_at(vars(host_local_pc, idp_pc, returnees_pc, rakhine_stateless_pc, total_pc), ~ round(., digits = 2)) %>%
  rename(`host_local%` = host_local_pc,
         `idp%` = idp_pc,
         `returnees%` = returnees_pc,
         `rakhine_stateless%` = rakhine_stateless_pc,
         `total%` = total_pc) %>% 
  kable(caption = "Percentage of 2021 HRP target reached by beneficiary type") %>% 
  kable_classic_2("striped") %>%  
  footnote("Only HRP/IERP beneficiaries have ben included",
           general_title = "")
  # pander(caption = "Percentage of 2021 HRP target reached by beneficiary type")

  
```

<br>

Unfortunately, the FSC monitoring system does not allow for the categorisation of FSC beneficiaries according to their food security status (moderately or severely food insecure). This limitation does not allow the FSC to determine whether the most vulnerable households were reached by food security assistance. The FSC will strive to bridge this gap in 2022 by: 

* Enquiring about FSC partners' beneficiary selection criteria and food security status assessments
* Developing a common food security data collection system 
* Exploring new options for food security assessments (satellite photos, outsourcing assessments to external partners, third-party monioring, etc.)

<br><br>

### 4.3 Monthly progress by beneficiary type

<br>

```{r beneficiary-types-progress-over-time-facet}
ben %>% 
  filter(!is.na(beneficiary_type)) %>% 
  group_by(beneficiary_type) %>% 
  arrange(date) %>% 
  mutate(cum_ben = cumsum(beneficiaries)) %>%
  mutate(beneficiary_type = fct_reorder(beneficiary_type, cum_ben, max, .desc = TRUE)) %>%  
  ggplot(aes(x = date, y = cum_ben)) +
  geom_line(size = 0.7) + 
  scale_x_date(date_breaks = "1 month", date_labels = "%b") +
  scale_y_continuous(labels = comma) +
  geom_vline(colour = "red", lty = 2, xintercept = as.numeric(as.Date("2021-06-01"))) +
  facet_wrap(~ beneficiary_type, scales = "free_y") +
  theme(legend.position = "none",
        axis.text.x = element_text(size = 7)) + # see if this works when you knit, then do it for the other plots 
  labs(x = "Month", 
       y = "Cumulative beneficiaries", 
       title = "Monthly progress by beneficiary type, 2021") + 
  theme(plot.title = element_text(size = 12))

```

<br>

A significant increase in the numbers of persons in the host/local community reached after June 2021 has been noted. Almost all host/local community beneficiaries were reached after the publication of the HRP addendum. Conversely, the progress amongst stateless persons in Rakhine slowed substantially after the publication of the addendum. The IERP response mainly focused on peri-urban areas in Yangon and Mandalay: these beneficiaries represented almost 2.1 million out of the 2.8 million persons reached in 2021. 

The context in Rakhine state has remained stable since the coup, with no major increase in conflict events. Consequently, food security assistance in Rakhine has followed the original food security programming, as laid out in the 2021 HRP. Regarding IDPs (8% of the caseload) and Returnees (0.07% of the caseload), it is difficult to measure the impact of the IERP on reaching these vulnerable groups. 

In September 2021, during the preparation of the Humanitarian Needs Overview, OCHA calculated the number of IDPs in Myanmar at 548,070 persons. For 2022, this population has been classified as severely food insecure. This means that the FSC must strive to reach this vulnerable group. In 2021, only 49% of IDPs were reached. 

Beneficiaries from the host/local community formed 28% of the beneficiaries under the HRP, but 97% of IERP beneficiaries. IDPs formed 29.5% of HRP beneficiaries, but only 3% of IERP beneficiaries. Stateless persons in Rakhine were only supported under the HRP as the IERP did not target Rakhine state. 

<br>

```{r table-ben-type-before-after-ierp}
fsc %>% 
  filter(unique_beneficiaries == "Yes") %>% 
  filter(!is.na(beneficiary_type)) %>% 
  sum_ben2(hrp_ierp, beneficiary_type) %>% 
  pivot_wider(names_from = hrp_ierp, values_from = beneficiaries) %>% 
  mutate(`%_of_HRP` = round(hrp / sum(hrp) * 100, digits = 2),
         `%_of_IERP` = round(ierp / sum(ierp, na.rm = TRUE) * 100, digits = 2), 
         `%_of_nonHRP` = round(non_hrp / sum(non_hrp, na.rm = TRUE) * 100, digits = 2)) %>% 
  relocate(hrp, .after = beneficiary_type) %>% 
  rename(HRP = hrp,
         IERP = ierp,
         non_HRP = non_hrp) %>% 
  kable(caption = "Beneficiaries reached by type, by response plan", format.args = list(big.mark = ",")) %>% 
  kable_classic_2() 
# pander(caption = "Beneficiaries reached by type, by response plan")
  
```



<br><br>

### 4.4 Gaps in monthly programming

```{r table-gaps-months}
# I feel like this is the most inefficient way to do this; still works, though 
# you're going to need to rewrite this when you have Q4 data 
gap_months <- fsc %>% 
  filter(frequency == "Monthly" & beneficiaries > 0) %>% 
  group_by(date, implementing_partners, activity, state, township, location) %>% 
  summarise(beneficiaries = sum(beneficiaries)) %>% 
  pivot_wider(names_from = date, values_from = beneficiaries) %>% 
  unnest() %>% 
  ungroup() %>% 
  mutate(recurrences = rowSums(!is.na(select(., -implementing_partners, -activity, -state, -township, -location))),
         ben_max = pmax(`2021-01-01`, `2021-02-01`, `2021-03-01`, `2021-04-01`, `2021-05-01`, `2021-06-01`,
                        `2021-07-01`, `2021-08-01`, `2021-09-01`, `2021-10-01`, `2021-11-01`, `2021-12-01`, na.rm = TRUE)) %>%
  pivot_longer(cols = c(`2021-01-01`, `2021-02-01`, `2021-03-01`, `2021-04-01`, `2021-05-01`, `2021-06-01`,
                        `2021-07-01`, `2021-08-01`, `2021-09-01`, `2021-10-01`, `2021-11-01`, `2021-12-01`), 
               names_to = "date", values_to = "beneficiaries") %>% 
  mutate(distribution = ifelse(is.na(beneficiaries), "n", "y")) %>% 
  select(-beneficiaries) %>% 
  pivot_wider(names_from = date, values_from = distribution) %>% 
  mutate(gaps = paste0(`2021-01-01`, `2021-02-01`, `2021-03-01`, `2021-04-01`, `2021-05-01`, `2021-06-01`,
                        `2021-07-01`, `2021-08-01`, `2021-09-01`, `2021-10-01`, `2021-11-01`, `2021-12-01`)) %>% 
  mutate(gap_months = case_when(str_detect(gaps, "ynnnnnnnnnnny") ~ 11,
                                str_detect(gaps, "ynnnnnnnnnny") ~ 10,
                                str_detect(gaps, "ynnnnnnnnny") ~ 9,
                                str_detect(gaps, "ynnnnnnnny") ~ 8,
                                str_detect(gaps, "ynnnnnnny") ~ 7,
                                str_detect(gaps, "ynnnnnny") ~ 6,
                                str_detect(gaps, "ynnnnny") ~ 5,
                                str_detect(gaps, "ynnnny") ~ 4,
                                str_detect(gaps, "ynnny") ~ 3,
                                str_detect(gaps, "ynny") ~ 2,
                                str_detect(gaps, "yny") ~ 1,
                                TRUE ~ 0)) 

## commented out, but this was just to get the number of townships with gaps per state
# gap_months %>% 
#   filter(recurrences > 1) %>% 
#   group_by(state, township) %>% 
#   summarise(avg_gap = mean(gap_months), 
#             beneficiaries = sum(ben_max)) %>% 
#   arrange(desc(avg_gap)) %>%
#   filter(avg_gap > 0) %>% 
#   group_by(state) %>%
#   summarise(townships = n_distinct(township))

gap_months %>% 
  filter(recurrences > 1) %>% 
  group_by(gap_months) %>% 
  summarise(locations = n_distinct(location),
            townships = n_distinct(township),
            beneficiaries = sum(ben_max)) %>% 
  mutate(pc_of_ben = round(beneficiaries / sum(beneficiaries) * 100, digits = 2)) %>%
  kable(caption = "Number of beneficiaries and locations by duration of gaps in implementation", format.args = list(big.mark = ",")) %>% 
  kable_classic_2("striped") %>%  
  footnote("Only beneficiaries of monthly activities that recurred at least once are included",
           general_title = "")
  # pander(caption = "Number of beneficiaries and locations by duration of gaps in implementation")

# reminder to check the paragraph below when you rerun the report

```
 
 <br>
 
`r round(filter(gap_months, recurrences > 1 & gap_months > 0 ) %>% {sum(.$ben_max)} / filter(gap_months, recurrences > 1) %>% {sum(.$ben_max)} * 100, digits = 1)`% of beneficiaries of monthly activities experienced gaps or delays in monthly programming, with the most common delay being 3 months. The 8-month delay was the provision of monthly food baskets in Buthidaung, where distributions only occurred in February and November 2021. The 5-month delays were all from locations in Rakhine and Kachin. Overall, gaps in monthly programming were experienced in 39 townships, with the majority originating from Kachin, Ayeyarwady and Rakhine.

Getting approvals for interventions and travel authorisations have significantly impeded the provision of assistance to vulnerable persons in Myanmar. 

There are `r filter(gap_months, recurrences == 1) %>% nrow()` entries coded as being implemented on a monthly basis that have not recurred -- that is, they have only been implemented once according to what has been reported in the 5Ws. The FSC needs to check with partners if these are merely the first instances of these activities, or if there have been issues with access, security or funding or if they are errors in data entry .

<br><br>

### 4.5 Potential for post-distribution monitoring

The table below shows activities which have been implemented for 6 months or more, the number of locations they were implemented in and the number of unique beneficiaries reached by activities meeting these criteria. The possibility of joint monitoring -- or at least the joint review and analysis of monitoring data -- shopuld be explored, in consultation with these partners. The rationale being that 6 months of implementation should be a long enough period of time to make impact monitoring feasible. Additionally, joint monitoring will be further facilitated by the similarity of these activities, almost all of which are recurrent cash transfers or distributions of food baskets.

```{r table-monthly-activities-6-9-months, warning=FALSE}

gap_months %>%  
  filter(recurrences > 5) %>% 
  group_by(activity) %>% 
  summarise(partners = n_distinct(implementing_partners),
            locations = n(),
            beneficiaries = sum(ben_max)) %>% 
  arrange(desc(beneficiaries)) %>% 
  kable(caption = "Number of beneficiaries, by activity, who have received at least 6 months of recurrent food security support",
        format.args = list(big.mark = ",")) %>% 
  kable_classic_2() %>%  
  footnote("Only includes beneficiaries (not unique but maximum by location by activity) who have received more than 6 months of support",
           general_title = "")
  # pander(caption = "Number of beneficiaries, by activity, who have received at least 6 months of recurrent food security support")

```

<br>

These are the partners who have implemented monthly food baskets and monthly cash-based transfers for more than 6 months:

```{r table-partners-6-months}
gap_months %>%  
  filter(recurrences > 5) %>% 
  group_by(activity, implementing_partners) %>% 
  summarise(beneficiaries = sum(ben_max), .groups = "drop") %>%  
  filter(activity == "Provide monthly food baskets" | activity == "Provide monthly cash-based transfers") %>% 
  pivot_wider(names_from = activity, values_from = beneficiaries) %>% 
  kable(caption = "Partners who have implemented cash transfers and food baskets for at least 6 months", 
        format.args = list(big.mark = ",")) %>% 
  kable_classic_2("striped") %>%  
  footnote("Only includes beneficiaries (not unique but maximum by location by activity) who have received more than 6 months of support",
           general_title = "")
# pander(caption = "Partners who have implemented cash transfers and food baskets for at least 6 months")
```



<br><br><br>

## 5. Coordination challenges and localisation 

### 5.1 Coordination challenges

The FSC coordination architecture, along with those of the other clusters, has been designed to support the deployment of humanitarian assistance in a limited number of states and regions. Throughout 2021, in spite of the expansion of conflict after the coup, humanitarian action remained largely limited to hubs centred around Rakhine (Central and northern Rakhine), Kachin and northern Shan, whilst humanitarian needs emerged in central, north-western and south-eastern Myanmar. 

The current sub-national coordination architecture is an impediment to the deployment of humanitarian assistance in areas newly affected by conflict. Coordination in these areas is necessary to closely monitor the deterioration of the humanitarian situation and coordinate appropriate responses with short notice. Coordination in these areas newly affected by conflict is also necessary to identify new partnerships, especially with NNGOs and CSOs. 

<br><br>

### 5.2 Localisation

The lack of ownership of coordination structures and processes by NNGOs and CSOs is a serious challenge at the national level. Many local partners prefer to coordinate only at the sub-national level. The two main limitations are:

* English is the main language during FSC national meetings 
* Local partners tend to prefer maintaining a low profile

It is important for the FSC to better integrate local partners into its coordination mechanisms and structures as they are the last-mile service providers in this humanitarian response. 

Despite the FSC providing an interepreter in its national coordination meetings, the participation of national partners remains limited. The FSC will consider the translation of key documents into Myanmar and other local languages. 

The FSC is also exploring the appointment of a national partner, at national level, who will be the focal point for NNGOs and CSOs. This will allow for more direct communication with local partners to: 

* better monitor the situation on the ground
* build local partners' ownership of national FSC coordination processes and structures

<br><br><br>


## 6. Perspective for 2022

### 6.1 Positioning for 2022

The PIN for 2022 is much more evenly spread across the country than it was in 2021: with reference to the plot below, Magway and Mandalay have some of the lowest proportions of vulnerable persons in relation to the total state population, meaning that careful beneficiary selection, tight vulnerability criteria and the analysis of food security status will necessary to avoid excessive inclusion errors.

However, the PIN and severity status has been estimated based on data collected in August and September through a WFP/FAO assessment. As the situation in the field remains volatile, it is necessary for FSC partners to collect evidence of any changes that may affect the food security of affected persons. 

<br>

```{r barplot-pin-vul-state}
pin %>% 
  group_by(state) %>% 
  filter(state != "Nay Pyi Taw") %>% 
  summarise(pin_2022 = round(sum(pin_2022)),
            total_pop = sum(total_pop)) %>% 
  mutate(`%_of_pop_in_PIN` = round(pin_2022 / total_pop * 100, digits = 2),
         state = reorder(state, -`%_of_pop_in_PIN`))  %>% 
  ggplot(aes(x = state, y = pin_2022, fill = `%_of_pop_in_PIN`)) +
  geom_col() +
  geom_text(aes(label = `%_of_pop_in_PIN`), size = 2.5, vjust = -0.5) +
  theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust = 0.6)) +
  labs(x = "",
       y = "Number of people in need", 
       fill = "% of pop \n in PIN",
       title = "2022 PIN and incidence of food insecurity and displacement by state and region",
       subtitle = "The 2022 food security PIN is the number of persons who are food insecure or are IDPs") +
  scale_y_continuous(breaks = seq(0, 2400000, by = 200000), labels = comma) +
  scale_fill_continuous(trans = "reverse")
```

<br>

```{r vector-and-df-for-pin-stacked}
sr_pin_ord <- c("Chin", "Kayah", "Rakhine", "Shan (South)", "Shan (North)", "Shan (East)", "Kayin", "Ayeyarwady", "Kachin", "Tanintharyi",
                "Mon", "Bago (East)", "Bago (West)", "Yangon", "Magway", "Sagaing", "Mandalay")

sr_pin_bar <- pin %>% 
  filter(state != "Nay Pyi Taw") %>%
  group_by(state) %>% 
  summarise(pin_2022 = round(sum(pin_2022)),
            target_2022 = round(sum(target_new))) %>% 
  mutate(non_target = pin_2022 - target_2022, 
         state = fct_relevel(state,sr_pin_ord)) %>%
  pivot_longer(cols = c(target_2022, non_target), names_to = "is_target", values_to = "pin") %>% 
  mutate(pc_of_pin = round(pin / pin_2022 * 100, digits = 2)) 

```


The average percentage of a state's PIN that is included in the target is `r round(sr_pin_bar %>% summarise(mean = mean(pc_of_pin[is_target == "target_2022"])), digits = 2) %>% pull()`%. Though there are some very notable exceptions at both the superior and inferior ends of the scale:

<br> 

```{r stacked-barplot-pin-target}
sr_pin_bar %>% 
  ggplot(aes(x = state, y = pin, fill = is_target)) +
  geom_col() +
  geom_text(aes(label = pc_of_pin), size = 2, vjust = 1.2, colour = "white") +
  theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust = 0.6), 
        legend.text = element_text(size = 5)) +
  labs(x = "",
       y = "Number of people in need", 
       fill = "",
       title = "2022 target as part of PIN by state and region",
       subtitle = "Figures in each bar show the percentage of PIN in and out of the 2022 targets") +
  scale_y_continuous(breaks = seq(0, 2400000, by = 200000), labels = comma)

          
```

<br> 

```{r has-partner-dataset}
has_partner <- pin %>% select(state, admin3_pcode, township, pin_new, target_2022) %>% 
  left_join(ben %>%  
              group_by(admin3_pcode) %>% 
              summarise(beneficiaries = sum(beneficiaries), 
                        partners = n_distinct(implementing_partners)), by = "admin3_pcode") %>% 
  replace(is.na(.), 0) %>% 
  mutate(has_partner = ifelse(partners == 0, FALSE, TRUE)) %>% 
  group_by(has_partner) %>% 
  summarise(pin_2022 = sum(pin_new),
            target_2022 = sum(target_2022),
            townships = n()) %>% 
  adorn_percentages("col") %>% 
  mutate(pin_2022 = round(pin_2022 * 100, digits = 2),
         target_2022 = round(target_2022 * 100, digits = 2),
         townships = round(townships * 100, digits = 2)) 

```

Food Security Cluster partners are not well-positioned to cover the 2022 population in need and targets. Partners are largely concentrated in Kachin, Rakhine and Yangon, with only one partner present in Shan (East) and two in Tanintharyi.

Overall, `r round(has_partner %>% filter(has_partner == FALSE) %>% pull(townships))`% of townships, containing `r round(has_partner %>% filter(has_partner == FALSE) %>% pull(target_2022))`% of the 2022 target, do not have any partners present. This lack of nationwide coverage will be one of the most important constraints that the FSC will face in meeting the 2022 needs of vulnerable, food insecure persons, including IDPs. Resolving this will necessitate both increasing partner coverage, finding new partners for the cluster as well as securing sufficient funding. 

```{r map-partners-target-township, fig.height=10}
# play with geom_line for the interactive reference map -- maybe you can get the outlines to be in different colours

ben %>% 
  group_by(admin3_pcode) %>% 
  summarise(partners = n_distinct(implementing_partners)) %>% 
  right_join(pcode3_shape, by = "admin3_pcode") %>% 
  st_as_sf() %>% 
  ggplot() +
  geom_sf(aes(fill = partners), size = 0.1) +
  # scale_fill_gradient(trans = "reverse", breaks = c(1, 3, 5, 7, 9,11)) +
  scale_fill_viridis_c(option = "mako", direction = -1, breaks = c(1, 3, 5, 7, 9, 11)) +
  theme_void() + 
  theme(legend.text = element_text(size = 10),
        legend.title = element_text(size = 10),
        legend.key.size = unit(0.7, 'cm')) +
  labs(title = "Map of number of partners by township",
       subtitle = "townships in grey do not have any partners present", 
       fill = "Partners") +
  
pin %>%    
    group_by(admin3_pcode) %>% 
    summarise(target_2022 = sum(target_2022)) %>% 
    mutate(target_2022 = round(target_2022, digits = 0), 
           target_2022 = recode(target_2022, 
                                '0' = NA_real_)) %>%
    right_join(pcode3_shape, by = "admin3_pcode") %>% 
    st_as_sf() %>% 
    ggplot() +
    geom_sf(aes(fill = target_2022), size = 0.1) +
  scale_fill_viridis_c(option = "mako", trans = "log10", direction = -1, begin = 0.15) +
    # scale_fill_gradient(trans = revlog_trans(10), breaks = c(100, 1000, 10000, 100000)) +
    theme_void() +
    theme(legend.text = element_text(size = 10),
          legend.title = element_text(size = 10),
          legend.key.size = unit(0.7, 'cm')) +
    labs(title = "Map of 2022 targets by township",
         subtitle = "townships in grey do not have any targets", 
         fill = "Targets")

```

This mismatch between existing partner footprints and the PIN for 2022 highlights the need for more dedicated field-level coordination. This will be necessary to reach out to new partners and encourage existing partners to expand their operations. Strengthened inter-cluster coordination will also be key to ensure that the needs of persons in need are being met in a comprehensive manner.    

<br><br>

### 6.2 Next steps

1.  Communicate to partners that Yangon has been heavily supported by humanitarian assistance in comparison to the rest of the country, with this coverage being particularly heavy in Hlaingtharya, Shwepyithar, Dagon Myothit (Seikkan), Dala and North Okkalapa townships.

2.  Develop, with FSC partners, standardised packages for the various types of food security assistance. Support the review of food baskets for the compliance with the standard of 2,100 kcal/person/day. 

3. Perform additional analysis to understand if beneficiaries in close proximity to each other have received widely divergent package values or not. 

4. Identify, with FSC partners, why cash transfer values vary even the same activity implemented by the same partner. 

5. Review areas which have only received smaller supplementary transfers. Transfers covering a low percentage of the MEB cannot be considered to have met food security needs unless they were provided along with sufficient in-kind support or in coordination with other partners to cover the gap.  

6. Advocate for the expansion of partners' geographic footprints to reach the remaining 179 townships which have yet to benefit from any FSC activities. Even though food security needs remain high in "traditional" HRP areas, food security assistance in the "newly" affected areas are an urgent need. FSC has started flagging this situation to the the FSC lead agencies, FSC partners, OCHA and donors. 

7. Collect 5W data from other clusters so that multi-sector coverage may be reviewed. Clean and process conflict data so that it may be cross-referenced with partners' coverage. Share raw data with other Clusters to improve coordination. 

8. Work with partners to determine their current capacities to submit age and sex-disaggregated beneficiary data at a household level. Develop a workplan to ensure that they can meet reporting requirements. 

9. Solicit monitoring reports from partners, explore the possibility of joint monitoring and determine the extent to which the food security status (moderately and severely food insecure) of beneficiaries can be identified. 

10. Revise the 5W template -- in consultation with partners -- in order to address the data collection issues identified. 

11. Develop the FSC's coordination capacities at sub-national level. 

12. Develop local partners' (NNGOs, CSOs) ownership of FSC coordination mechanisms and structures and provide key FSC documents in Burmese and other local languages. 



<br><br><br>

## 7. Reference table -- townships

The reference table below may be sorted and filtered by any of the columns. 

```{r datatable-townships-reference}
# add in target
pin %>% 
  select(state, township, admin3_pcode, total_pop, PIN_2022 = pin_2022, target_2022, IDPs = idps) %>% 
  mutate(total_pop = round(total_pop, digits = 0)) %>% 
  left_join(fsc %>%
              select(activity, partners = implementing_partners, beneficiaries = u_ben, beneficiary_frequencies = beneficiaries,
                     location, admin3_pcode) %>% 
              group_by(admin3_pcode) %>% 
              summarise(partners = n_distinct(partners),
                        beneficiaries = sum(beneficiaries, na.rm = TRUE),
                        beneficiary_frequencies = sum(beneficiary_frequencies, na.rm = TRUE),
                        locations = n_distinct(location)), by = "admin3_pcode") %>%
  replace_na(list(partners = 0, beneficiaries = 0, beneficiary_frequencies = 0, locations = 0)) %>% 
  relocate(admin3_pcode, .after = locations) %>% 
  arrange(admin3_pcode) %>% 
  datatable(filter = list(position = "top", clear = FALSE), 
            options = list(pageLength = 10, scrollX = TRUE
  #                         
  #                         ,
  #                                         initComplete = htmlwidgets::JS(
  #        "function(settings, json) {",
  #        paste0("$(this.api().table().container()).css({'font-size': '", "8.5pt", "'});"),
  #        "}")
       ) 
     ) %>% 
  formatRound(c("total_pop", "beneficiaries", "IDPs", "PIN_2022", "target_2022", "beneficiary_frequencies"), digits = 0)
```

<br><br><br>

## 8. Interactive reference maps

Click **[here](https://food-security-cluster-myanmar.github.io/mmr_5w_initial_observations_maps/)** to load maps. This might take some time as the files are quite large.  






